<!-- Empty override file take the place of env/lib/python3.8/site-packages/sphinx_rtd_theme/breadcrumbs.html, which generates the top nav breadcrumbs. -->

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>bdschism.parse_cu &mdash; Bay-Delta SCHISM</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/style.css?v=8686dbcc" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=ca842793"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs"></script>
      <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";import elkLayouts from "https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs";mermaid.registerLayoutLoaders(elkLayouts);mermaid.initialize({startOnLoad:false});</script>
      <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
      <script type="module">
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.addEventListener("load", () => mermaid.run());
</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link href="../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/logo6.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Bay-Delta SCHISM Project</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getmodel.html">Installation And Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../getmodel.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getmodel.html#schism-software-code-binaries">SCHISM Software Code/Binaries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getmodel.html#downloading">Downloading</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getmodel.html#compile-settings">Compile Settings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../getmodel.html#bay-delta-schism-python-package">Bay-Delta SCHISM Python Package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getmodel.html#id1">Downloading</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getmodel.html#contents">Contents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getmodel.html#bathymetry">Bathymetry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getmodel.html#complete-sample-inputs">Complete Sample Inputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getmodel.html#other-required-python-packages">Other Required Python Packages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../getmodel.html#configuration-system">Configuration System</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getmodel.html#id3">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getmodel.html#configuration-file-locations-and-priorities">Configuration File Locations and Priorities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getmodel.html#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getmodel.html#example-configuration-file">Example Configuration File</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../getmodel.html#visit-schism-plug-in">VisIt SCHISM Plug-in</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getmodel.html#links-to-tools">Links to tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide.html">Bay-Delta SCHISM User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide.html#essentials-for-running-the-model">Essentials for Running the Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../topics/processed_run.html">Running a Preprepared Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/overview.html">Overview of a Bay-Delta SCHISM Run</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/overview.html#grid-and-spatial-data">Grid and Spatial Data</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../topics/overview.html#templates">Templates</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/overview.html#preprocessor">Preprocessor</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/overview.html#time-dependent-data">Time-dependent data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/overview.html#files-that-change-with-both-mesh-and-dates">Files that Change with Both Mesh and Dates</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/overview.html#driver-files-param-tropic-nml-param-clinic-nml">Driver Files (param.tropic.nml, param.clinic.nml)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/overview.html#other-nomenclature-and-concepts">Other Nomenclature and Concepts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/overview.html#organizing-the-launch-directory">Organizing the Launch Directory</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/vignette.html">Vignette: Hindcast Bay Delta SCHISM at Delta Modeling Section with Preprocessor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/vignette.html#windows">Windows</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/vignette.html#linux">Linux</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../topics/vignette.html#barotropic">Barotropic</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/vignette.html#baroclinic">Baroclinic</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/files_and_directories.html">Required Files, Directory Structure and Recommended Study Practices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/files_and_directories.html#required-files-and-structure">Required files and structure</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../topics/files_and_directories.html#schism-launch-directory-structure">SCHISM launch directory structure</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/files_and_directories.html#launch-directory">Launch directory</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/files_and_directories.html#output-directory">Output directory</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/files_and_directories.html#atmospheric-sflux-directory">Atmospheric (sflux) directory</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/files_and_directories.html#study-layout">Study layout</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/preprocess.html">Grid, Spatial Data and Preprocessor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/preprocess.html#do-i-need-it-copy-existing-run-vs-preprocess-from-template">Do I need it? Copy existing run vs preprocess from template?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/preprocess.html#running-the-preprocessor">Running the preprocessor</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../topics/preprocess.html#applying-the-template">Applying the template</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/preprocess.html#partial-preprocessing-for-modification">Partial preprocessing for modification</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/preprocess.html#configuring-the-input-yaml">Configuring the input (yaml)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/preprocess.html#where-to-required-files-and-directory-structure">Where to? Required files and directory structure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide.html#boundaries-input-files">Boundaries &amp; Input Files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../topics/ocean.html">Prepare Ocean Boundary (elev2D.th.nc)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/flow_boundary.html">Inflow/Outflow Boundaries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/flow_boundary.html#where-are-the-data">Where are the data?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/flow_boundary.html#clipping-to-run-dates-and-conversion-to-elapsed-time">Clipping to run dates and conversion to elapsed time</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/flow_boundary.html#what-if-i-have-to-add-or-move-a-boundary">What if I have to add or move a boundary?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/flow_boundary.html#adding-data-from-other-sources-e-g-forecasts-other-models">Adding Data From Other Sources (e.g. Forecasts, other models)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/atmospheric.html">Atmospheric setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/atmospheric.html#basic-introduction-and-requirements">Basic introduction and requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/atmospheric.html#where-are-the-data">Where are the data?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/atmospheric.html#pointing-to-the-data-with-make-links-full-py">Pointing to the data with make_links_full.py</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/barotropic.html">Ocean Boundary Stabilization: Barotropic Warmup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/barotropic.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/barotropic.html#workflow">Workflow</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../topics/barotropic.html#bctides-in">bctides.in</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/barotropic.html#param-nml">param.nml</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/barotropic.html#vgrid-in">vgrid.in</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../topics/barotropic.html#run-interpolate-variables-to-get-uv3d-th-nc">Run interpolate_variables to get uv3D.th.nc</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../topics/barotropic.html#move-the-outputs-directory-aside">Move the outputs directory aside</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/param.html">Key Run Parameters and Gotchas</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/param.html#runtime-settings">Runtime settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/param.html#hotstart-settings">Hotstart settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/param.html#nudging-settings">Nudging settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/param.html#output-requests">Output requests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/param.html#settings-that-have-historically-gone-awry">Settings that have historically gone awry</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/param.html#what-happens-when-schism-versions-get-advanced">What happens when SCHISM versions get advanced?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/hotstart.html">Run Initialization and Restart (Hotstart)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/hotstart.html#when-do-you-need-an-initial-condition-or-hotstart">When do you need an initial condition or hotstart?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/hotstart.html#what-is-the-difference-between-a-cold-and-hot-start">What is the difference between a cold and hot start?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/hotstart.html#combining-hotstarts">Combining hotstarts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/hotstart.html#choosing-a-good-start-time">Choosing a good start time</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/hotstart.html#creating-a-hotstart-for-hydro-salt-temp-with-schism-hotstart">Creating a Hotstart for Hydro/Salt/Temp with schism_hotstart</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../topics/hotstart.html#acquiring-the-data">Acquiring the data</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/hotstart.html#configuring-the-hotstart-request-yaml">Configuring the Hotstart request (yaml)</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/hotstart.html#running-the-hotstart-generator">Running the hotstart generator</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/nudging.html">Nudging Files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/nudging.html#introduction-what-is-nudging">Introduction: What is nudging?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/nudging.html#do-i-need-nudging">Do I need nudging?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/nudging.html#generating-nudging-files">Generating nudging files</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../topics/nudging.html#schimpy.nudging.Nudging"><code class="docutils literal notranslate"><span class="pre">Nudging</span></code></a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../topics/nudging.html#schimpy.nudging.Nudging.create_nudging"><code class="docutils literal notranslate"><span class="pre">Nudging.create_nudging()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/nudging.html#preparing-for-nudging-with-observed-data">Preparing for nudging with observed data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/nudging.html#nudging-example">Nudging Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/nudging.html#nudging-suffix-standards-and-procedure">Nudging Suffix Standards and Procedure</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../topics/nudging.html#schism-conventions">SCHISM Conventions</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/nudging.html#baydeltaschism-conventions">BayDeltaSCHISM Conventions</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/nudging.html#using-the-set-nudge-utility">Using the set_nudge Utility</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../topics/nudging.html#bds-set-nudge">bds set_nudge</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/nudging.html#sequencing-your-run">Sequencing your run</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/nudging.html#references">References</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/vegetation.html">Vegetation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/vegetation.html#aquatic-vegetation-in-schism">Aquatic Vegetation in SCHISM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/vegetation.html#approximations-and-preprocessor">Approximations and preprocessor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/vegetation.html#effective-stem-density">Effective Stem Density</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/vegetation.html#height">Height</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide.html#inspection-of-model-setup">Inspection of Model Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../topics/checklists.html">Checklists</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/checklists.html#running-a-processed-setup">Running a Processed Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/checklists.html#simple-hindcast-runs">Simple Hindcast Runs</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../topics/checklists.html#cbox-choose-run-dates">☐ Choose run dates</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/checklists.html#cbox-apply-template-to-existing-mesh">☐ Apply template to existing mesh</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/checklists.html#cbox-collect-time-series-inputs">☐ Collect time series inputs</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/checklists.html#cbox-hotstart-can-be-concurrent-with-barotropic">☐ Hotstart (can be concurrent with barotropic)</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/checklists.html#cbox-nudging-can-be-concurrent-with-barotropic">☐ Nudging (can be concurrent with barotropic)</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/checklists.html#cbox-barotropic-warmup">☐ Barotropic warmup</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/checklists.html#cbox-baroclinic-simulation">☐ Baroclinic simulation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/run_tests.html">Test Suite for Prechecking Runs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/run_tests.html#using-the-tests">Using the Tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/run_tests.html#writing-run-tests">Writing Run Tests</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../topics/run_tests.html#basics-of-testing">Basics of testing</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/run_tests.html#test-fixtures">Test Fixtures</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/run_tests.html#markers">Markers</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/run_tests.html#what-to-test">What to test</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide.html#output-files">Output Files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../topics/output.html">Output</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/output.html#flavors-of-output">Flavors of output</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/output.html#what-you-should-plan-in-advance">What you should plan in advance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/output.html#request-station-output">Request station output</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../topics/output.html#station-in">station.in</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/output.html#flow-xsects-yaml-and-fluxflags-out">flow_xsects.yaml and fluxflags.out</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/output.html#request-dense-output">Request dense output:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/output.html#working-with-staout-files">Working with staout_ files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/output.html#working-with-flux-out-files">Working with flux.out files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/output.html#visualizing-dense-nc-output-in-visit">Visualizing dense (.nc) output in VisIt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/output.html#schism-s-extraction-utilities">SCHISM’s extraction utilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/output.html#quick-validation-plots">Quick validation plots</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/output.html#where-do-we-keep-specialized-postprocessing-materials">Where do we keep specialized postprocessing materials?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide.html#computing-resources">Computing Resources</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../topics/hpc.html">Intro to Clusters and High Performance Computing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/hpc.html#anatomy-of-a-cluster">Anatomy of a Cluster</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/hpc.html#figure-cluster-components">Figure: Cluster Components</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/hpc.html#compilation">Compilation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/hpc.html#job-submission">Job Submission</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/hpc.html#compute-nodes-and-message-passing">Compute Nodes and Message Passing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/hpc.html#input-output-and-scribes">Input/Output and Scribes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/hpc.html#example-slurm-launch-file">Example Slurm Launch File</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/hpc.html#example-shell-script-to-run-schism">Example Shell Script to Run SCHISM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/hpc.html#intro-to-batch-cloud-cluster">Intro to Batch Cloud Cluster</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/hpc.html#figure-azure-batch-cluster-components">Figure: Azure Batch Cluster Components</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/azure.html">Running on Azure Batch</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/azure.html#setup-azure">Setup Azure</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../topics/azure.html#download-azure-utilities">Download Azure Utilities</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/azure.html#login">Login</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/azure.html#create-a-resource-group">Create a Resource Group</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/azure.html#download-azure-dms-batch">Download azure_dms_batch</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/azure.html#upload-applications">Upload Applications</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../topics/azure.html#schism">SCHISM</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/azure.html#python-packages">Python Packages</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/azure.html#file-transfer-commands">File Transfer Commands</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../topics/azure.html#azcopy-commands">azcopy commands</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../topics/azure.html#generating-sas-links">Generating SAS Links</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/azure.html#azcopy-options">azcopy options</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/azure.html#references">References</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/helloschism_azure.html">Step-by-step: HelloSCHISM on Azure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/helloschism_azure.html#initial-setup">Initial Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/helloschism_azure.html#uploading-model-input-files">Uploading Model Input Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/helloschism_azure.html#set-up-model-run-config">Set up Model Run Config</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../topics/helloschism_azure.html#spot-pricing-config">Spot Pricing Config</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/helloschism_azure.html#ensure-batch-quota">Ensure Batch Quota</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/helloschism_azure.html#run-simulation">Run Simulation!</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/bds_guide_azure.html">Step-by-step: Bay-Delta SCHISM on Azure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/bds_guide_azure.html#initial-setup">Initial Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/bds_guide_azure.html#uploading-model-input-files">Uploading Model Input Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/bds_guide_azure.html#running-model-simulation">Running Model Simulation</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../topics/bds_guide_azure.html#simple-run-config">Simple Run Config</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/bds_guide_azure.html#spot-pricing-config">Spot Pricing Config</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide.html#advanced-tasks-and-concepts">Advanced Tasks and Concepts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../topics/problems.html">Common Problems and Diagnosis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/problems.html#where-does-schism-write-error-messages">Where does SCHISM write error messages?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/problems.html#my-run-says-segfault">My run says “segfault”</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/problems.html#the-runs-seems-very-slow-compared-to-normal">The runs seems very slow compared to normal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/problems.html#dry-boundary">Dry boundary</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/age.html">Simulating water age</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/age.html#compile-with-age">Compile with age</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/age.html#parameters-in-param-nml">Parameters in param.nml</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/age.html#additional-ic-files">Additional *.ic files</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/age.html#hotstart-considerations">Hotstart considerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/age.html#typical-output-processing">Typical output processing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/sea_level_rise.html">Sea Level Rise</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/sources.html">Sources, Sinks, Delta Channel Depletions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/sources.html#identifying-source-locations-and-names-in-preprocessor">Identifying source locations and names in preprocessor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/sources.html#delta-and-suisun-channel-depletions">Delta and Suisun channel depletions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/sources.html#making-sure-you-includ-the-th-files-for-sources-sinks">Making sure you includ the th files for sources/sinks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/sources.html#tracer-concentrations">Tracer concentrations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/structures.html">Hydraulic Structures</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/structures.html#where-is-the-documentation">Where is the documentation?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/structures.html#setting-up-the-mesh-to-make-structures-easy">Setting up the mesh to make structures easy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/structures.html#preventing-dry-boundary-messages">Preventing dry boundary messages</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/structures.html#important-bay-delta-examples">Important Bay-Delta examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/mesh.html">Gridding the Horizontal Mesh</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/mesh.html#meshing">Meshing</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../topics/mesh.html#meshing-considerations-for-schism">Meshing considerations for SCHISM</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../topics/mesh.html#video-joseph-zhang-schism-summit">Video (Joseph Zhang, SCHISM summit)</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../topics/mesh.html#recap-checklist">Recap/checklist</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/mesh.html#getting-to-know-sms">Getting to know SMS</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../topics/mesh.html#sample-data">Sample Data</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../topics/mesh.html#id1">Recap checklist</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../topics/mesh.html#presentation-clip-dems-and-efficient-use-of-dems">Presentation: clip_dems and efficient use of DEMS</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/mesh.html#building-the-bay-delta-mesh-the-standard-way">Building the Bay-Delta mesh the standard way</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/mesh.html#presentation-meshing-consideration-for-marshes-and-restoration">Presentation: Meshing consideration for marshes and restoration</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/mesh.html#merging-stitching-sms-mesh-maps-new-work-flooded-islands-etc">Merging/Stitching SMS mesh/maps (new work, flooded islands, etc)</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../topics/mesh.html#video">Video</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../topics/mesh.html#id2">Recap/checklist</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/mesh.html#vertical-mesh-setup">Vertical mesh setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/mesh.html#checklist-for-after-you-change-the-mesh">Checklist for after you change the mesh</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/mesh.html#performance-tuning">Performance Tuning</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../topics/mesh.html#the-analyze-dt-utility">The analyze_dt Utility</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../topics/utilities.html">Utilities and Scripts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../topics/utilities.html#gis-conversion">GIS Conversion</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../topics/utilities.html#mesh-to-shapefile">Mesh to shapefile</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/utilities.html#polygons-to-from-shapefile">Polygons to/from shapefile</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../topics/utilities.html#polylines-to-from-shapefile">Polylines to/from shapefile</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/utilities.html#hotstart-inventory-convert-iteration-numbers-to-dates">Hotstart Inventory: Convert iteration numbers to dates</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../topics/utilities.html#model-time-and-multi-clip">model_time and multi_clip</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../learning.html">Learning Resources for Bay-Delta SCHISM</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../learning.html#general-resources-and-tools">General Resources and Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bay_delta_tutorials.html">Bay-Delta SCHSIM Tutorials</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../linux.html">Linux Hints for SCHISM</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../linux.html#using-linux-from-windows">Using Linux from Windows</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../linux.html#basic-connection">Basic connection</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../linux.html#copying-files">Copying files</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../linux.html#xwindow-emulation">XWindow Emulation</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../linux.html#all-in-one-mobaxterm">All-in-one: MobaXTerm</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../linux.html#copying-a-run-safely">Copying a Run Safely</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../linux.html#special-case-remote-computer-using-rsa-keys">Special Case: Remote Computer Using RSA Keys</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../linux.html#symbolic-links">Symbolic links</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../linux.html#archives-and-tarballs">Archives and Tarballs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../linux.html#essential-commands-in-a-schism-context">Essential commands in a SCHISM context</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../learning.html#manuals">Manuals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../learning.html#getting-help">Getting Help</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../learning.html#vims-and-other-external-resources">VIMS and Other External Resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">Contributing to the Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#getting-started">Getting Started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../documentation.html#windows">Windows</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../documentation.html#linux">Linux</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#how-it-works">How it works</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../documentation.html#local-html-pages">Local html pages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../documentation.html#github-pages">GitHub Pages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#examples-and-concepts">Examples and Concepts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../meta_doc/doc_sphinx.html">Sphinx Documentation Principles</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../meta_doc/doc_sphinx.html#code-auto-documentation">Code Auto-Documentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../meta_doc/doc_sphinx.html#headings-order">Headings order</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../meta_doc/doc_sphinx.html#baydeltaschism-specifics">BayDeltaSCHISM Specifics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../meta_doc/doc_sphinx.html#sphinx-examples">Sphinx examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../meta_doc/doc_sphinx.html#math">Math</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../meta_doc/doc_sphinx.html#figures">Figures</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../meta_doc/doc_sphinx.html#diagrams">Diagrams</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../meta_doc/doc_sphinx.html#sphinx-mermaid-directive">Sphinx Mermaid Directive</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../meta_doc/doc_sphinx.html#embedding-charts-with-svg">Embedding Charts with SVG</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../meta_doc/doc_sphinx.html#embedding-videos">Embedding Videos</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../meta_doc/doc_mermaid.html">Mermaid Chart Principles</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../meta_doc/doc_mermaid.html#baydeltaschism-standards">BayDeltaSCHISM Standards</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../meta_doc/doc_mermaid.html#symbols">Symbols</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../meta_doc/doc_mermaid.html#style">Style</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../meta_doc/doc_mermaid.html#vs-code-plugin">VS Code plugin</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../meta_doc/doc_mermaid.html#cool-stuff">Cool stuff</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../meta_doc/doc_mermaid.html#clickables">Clickables</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../meta_doc/doc_mermaid.html#icons-in-an-element">Icons in an Element</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../meta_doc/doc_click.html">Click Documentation Principles</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../calibration.html">Calibration Report and References</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../calibration.html#calibration">Calibration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../help.html">Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../help.html#support">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../refs.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bdschism.html">bdschism package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#subpackages">Subpackages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.config.html">bdschism.config package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bdschism.config.html#module-bdschism.config">Module contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#module-bdschism.analyze_dt">bdschism.analyze_dt module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.analyze_dt.load_data"><code class="docutils literal notranslate"><span class="pre">load_data()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.analyze_dt.plot_summarized_bad_actors"><code class="docutils literal notranslate"><span class="pre">plot_summarized_bad_actors()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.analyze_dt.summarize_elements"><code class="docutils literal notranslate"><span class="pre">summarize_elements()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#module-bdschism.calc_ndoi">bdschism.calc_ndoi module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.calc_ndoi.calc_indoi"><code class="docutils literal notranslate"><span class="pre">calc_indoi()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#module-bdschism.ccf_gate_height">bdschism.ccf_gate_height module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.ccf_gate_height.ccf_gate"><code class="docutils literal notranslate"><span class="pre">ccf_gate()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.ccf_gate_height.create_priority_series"><code class="docutils literal notranslate"><span class="pre">create_priority_series()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.ccf_gate_height.draw_down_regression"><code class="docutils literal notranslate"><span class="pre">draw_down_regression()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.ccf_gate_height.export_lookup"><code class="docutils literal notranslate"><span class="pre">export_lookup()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.ccf_gate_height.flow_to_max_gate"><code class="docutils literal notranslate"><span class="pre">flow_to_max_gate()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.ccf_gate_height.flow_to_priority"><code class="docutils literal notranslate"><span class="pre">flow_to_priority()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.ccf_gate_height.gen_gate_height"><code class="docutils literal notranslate"><span class="pre">gen_gate_height()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.ccf_gate_height.gen_prio_for_varying_exports"><code class="docutils literal notranslate"><span class="pre">gen_prio_for_varying_exports()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.ccf_gate_height.get_export_ts"><code class="docutils literal notranslate"><span class="pre">get_export_ts()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.ccf_gate_height.get_tidal_hh_lh"><code class="docutils literal notranslate"><span class="pre">get_tidal_hh_lh()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.ccf_gate_height.get_tidal_ll_hl"><code class="docutils literal notranslate"><span class="pre">get_tidal_ll_hl()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.ccf_gate_height.make_3_prio"><code class="docutils literal notranslate"><span class="pre">make_3_prio()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.ccf_gate_height.predict_oh4_level"><code class="docutils literal notranslate"><span class="pre">predict_oh4_level()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.ccf_gate_height.process_height"><code class="docutils literal notranslate"><span class="pre">process_height()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.ccf_gate_height.radial_gate_flow"><code class="docutils literal notranslate"><span class="pre">radial_gate_flow()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.ccf_gate_height.raidal_gate_flow_ts"><code class="docutils literal notranslate"><span class="pre">raidal_gate_flow_ts()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.ccf_gate_height.remove_continuous_duplicates"><code class="docutils literal notranslate"><span class="pre">remove_continuous_duplicates()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.ccf_gate_height.save_prio_ts"><code class="docutils literal notranslate"><span class="pre">save_prio_ts()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.ccf_gate_height.sffpx_level"><code class="docutils literal notranslate"><span class="pre">sffpx_level()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.ccf_gate_height.simple_mass_balance"><code class="docutils literal notranslate"><span class="pre">simple_mass_balance()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.ccf_gate_height.tlmax"><code class="docutils literal notranslate"><span class="pre">tlmax()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.ccf_gate_height.tlmin"><code class="docutils literal notranslate"><span class="pre">tlmin()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#module-bdschism.create_sflux_links">bdschism.create_sflux_links module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#module-bdschism.diff_gr3">bdschism.diff_gr3 module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.diff_gr3.diff_congruent_gr3"><code class="docutils literal notranslate"><span class="pre">diff_congruent_gr3()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#module-bdschism.generate_realtime_elev2d">bdschism.generate_realtime_elev2d module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.generate_realtime_elev2d.main"><code class="docutils literal notranslate"><span class="pre">main()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.generate_realtime_elev2d.stitch_station"><code class="docutils literal notranslate"><span class="pre">stitch_station()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#module-bdschism.hotstart_date">bdschism.hotstart_date module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.hotstart_date.set_hotstart_date"><code class="docutils literal notranslate"><span class="pre">set_hotstart_date()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#module-bdschism.hotstart_from_hotstart">bdschism.hotstart_from_hotstart module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.hotstart_from_hotstart.hotstart_newgrid"><code class="docutils literal notranslate"><span class="pre">hotstart_newgrid()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.hotstart_from_hotstart.str_or_path"><code class="docutils literal notranslate"><span class="pre">str_or_path()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#module-bdschism.hotstart_nudging_data">bdschism.hotstart_nudging_data module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.hotstart_nudging_data.hotstart_nudge_data"><code class="docutils literal notranslate"><span class="pre">hotstart_nudge_data()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#module-bdschism.parse_cu">bdschism.parse_cu module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.parse_cu.adjust_src_sink"><code class="docutils literal notranslate"><span class="pre">adjust_src_sink()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.parse_cu.calc_net_calsim"><code class="docutils literal notranslate"><span class="pre">calc_net_calsim()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.parse_cu.calc_net_diff"><code class="docutils literal notranslate"><span class="pre">calc_net_diff()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.parse_cu.calc_net_dsm2"><code class="docutils literal notranslate"><span class="pre">calc_net_dsm2()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.parse_cu.calc_net_obs_schism"><code class="docutils literal notranslate"><span class="pre">calc_net_obs_schism()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.parse_cu.calc_net_schism"><code class="docutils literal notranslate"><span class="pre">calc_net_schism()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.parse_cu.calc_srcsnk_dsm2"><code class="docutils literal notranslate"><span class="pre">calc_srcsnk_dsm2()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.parse_cu.orig_pert_to_schism_dcd"><code class="docutils literal notranslate"><span class="pre">orig_pert_to_schism_dcd()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.parse_cu.orig_pert_to_schism_dcd_yaml"><code class="docutils literal notranslate"><span class="pre">orig_pert_to_schism_dcd_yaml()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.parse_cu.read_net_csv"><code class="docutils literal notranslate"><span class="pre">read_net_csv()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.parse_cu.sch_dcd_net_diff"><code class="docutils literal notranslate"><span class="pre">sch_dcd_net_diff()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.parse_cu.strip_dpart"><code class="docutils literal notranslate"><span class="pre">strip_dpart()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#bdschism-plot-input-boundaries-module">bdschism.plot_input_boundaries module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#bdschism-port-boundary-module">bdschism.port_boundary module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#module-bdschism.profile_plot">bdschism.profile_plot module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.profile_plot.get_index_bounds"><code class="docutils literal notranslate"><span class="pre">get_index_bounds()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.profile_plot.nearest_neighbor_fill"><code class="docutils literal notranslate"><span class="pre">nearest_neighbor_fill()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.profile_plot.profile_plot"><code class="docutils literal notranslate"><span class="pre">profile_plot()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.profile_plot.set_index_bounds"><code class="docutils literal notranslate"><span class="pre">set_index_bounds()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.profile_plot.vertical_fill"><code class="docutils literal notranslate"><span class="pre">vertical_fill()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#module-bdschism.read_dss">bdschism.read_dss module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.read_dss.check_exclude"><code class="docutils literal notranslate"><span class="pre">check_exclude()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.read_dss.read_dss"><code class="docutils literal notranslate"><span class="pre">read_dss()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#module-bdschism.run_sequence">bdschism.run_sequence module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#module-bdschism.set_nudging">bdschism.set_nudging module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.set_nudging.get_nudge_list"><code class="docutils literal notranslate"><span class="pre">get_nudge_list()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.set_nudging.parse_var_map"><code class="docutils literal notranslate"><span class="pre">parse_var_map()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.set_nudging.set_nudging"><code class="docutils literal notranslate"><span class="pre">set_nudging()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#module-bdschism.settings">bdschism.settings module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.settings.create_link"><code class="docutils literal notranslate"><span class="pre">create_link()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.settings.get_settings"><code class="docutils literal notranslate"><span class="pre">get_settings()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#module-bdschism.three_point_linear_norm">bdschism.three_point_linear_norm module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.three_point_linear_norm.ThreePointLinearNorm"><code class="docutils literal notranslate"><span class="pre">ThreePointLinearNorm</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bdschism.html#bdschism.three_point_linear_norm.ThreePointLinearNorm.autoscale"><code class="docutils literal notranslate"><span class="pre">ThreePointLinearNorm.autoscale()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bdschism.html#bdschism.three_point_linear_norm.ThreePointLinearNorm.autoscale_None"><code class="docutils literal notranslate"><span class="pre">ThreePointLinearNorm.autoscale_None()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bdschism.html#bdschism.three_point_linear_norm.ThreePointLinearNorm.inverse"><code class="docutils literal notranslate"><span class="pre">ThreePointLinearNorm.inverse()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bdschism.html#bdschism.three_point_linear_norm.ThreePointLinearNorm.scaled"><code class="docutils literal notranslate"><span class="pre">ThreePointLinearNorm.scaled()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#module-bdschism.uv3d">bdschism.uv3d module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.uv3d.interpolate_uv3d"><code class="docutils literal notranslate"><span class="pre">interpolate_uv3d()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#module-bdschism.x2_buildpoints">bdschism.x2_buildpoints module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.x2_buildpoints.create_arg_parser"><code class="docutils literal notranslate"><span class="pre">create_arg_parser()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.x2_buildpoints.main"><code class="docutils literal notranslate"><span class="pre">main()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.x2_buildpoints.main_fixed"><code class="docutils literal notranslate"><span class="pre">main_fixed()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.x2_buildpoints.x2_route2_bp"><code class="docutils literal notranslate"><span class="pre">x2_route2_bp()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#module-bdschism.x2_time_series">bdschism.x2_time_series module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.x2_time_series.create_arg_parser"><code class="docutils literal notranslate"><span class="pre">create_arg_parser()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.x2_time_series.default_outname"><code class="docutils literal notranslate"><span class="pre">default_outname()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.x2_time_series.find_x2"><code class="docutils literal notranslate"><span class="pre">find_x2()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.x2_time_series.get_start_date_from_param"><code class="docutils literal notranslate"><span class="pre">get_start_date_from_param()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.x2_time_series.main"><code class="docutils literal notranslate"><span class="pre">main()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.x2_time_series.main_hardwire"><code class="docutils literal notranslate"><span class="pre">main_hardwire()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.x2_time_series.process_x2"><code class="docutils literal notranslate"><span class="pre">process_x2()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#module-bdschism.zone_utils">bdschism.zone_utils module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.zone_utils.face_aver"><code class="docutils literal notranslate"><span class="pre">face_aver()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.zone_utils.face_aver_inst"><code class="docutils literal notranslate"><span class="pre">face_aver_inst()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.zone_utils.fill_ele_area"><code class="docutils literal notranslate"><span class="pre">fill_ele_area()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.zone_utils.fill_ele_area510"><code class="docutils literal notranslate"><span class="pre">fill_ele_area510()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.zone_utils.gen_node_neibor_ele"><code class="docutils literal notranslate"><span class="pre">gen_node_neibor_ele()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.zone_utils.gen_node_wet_dry"><code class="docutils literal notranslate"><span class="pre">gen_node_wet_dry()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.zone_utils.quad_area"><code class="docutils literal notranslate"><span class="pre">quad_area()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bdschism.html#bdschism.zone_utils.triangle_area"><code class="docutils literal notranslate"><span class="pre">triangle_area()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bdschism.html#module-bdschism">Module contents</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Bay-Delta SCHISM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <!-- Empty override file take the place of env/lib/python3.8/site-packages/sphinx_rtd_theme/breadcrumbs.html, which generates the top nav breadcrumbs. -->
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for bdschism.parse_cu</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Script by Lily Tomkovic to take a net delta consumptive use and parse it into vsource and vsink&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">vtools.functions.unit_conversions</span><span class="w"> </span><span class="kn">import</span> <span class="n">CFS2CMS</span><span class="p">,</span> <span class="n">CMS2CFS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">vtools.functions.interpolate</span><span class="w"> </span><span class="kn">import</span> <span class="n">rhistinterp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">vtools.data.vtime</span><span class="w"> </span><span class="kn">import</span> <span class="n">days</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">schimpy.model_time</span><span class="w"> </span><span class="kn">import</span> <span class="n">read_th</span><span class="p">,</span> <span class="n">is_elapsed</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">schimpy.th_calcs</span><span class="w"> </span><span class="kn">import</span> <span class="n">calc_net_source_sink</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">schimpy.util.yaml_load</span><span class="w"> </span><span class="kn">import</span> <span class="n">yaml_from_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bdschism.read_dss</span><span class="w"> </span><span class="kn">import</span> <span class="n">read_dss</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">click</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="n">bds_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s2">&quot;../../&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="adjust_src_sink">
<a class="viewcode-back" href="../../bdschism.html#bdschism.parse_cu.adjust_src_sink">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">adjust_src_sink</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">sink</span><span class="p">,</span> <span class="n">net_diff</span><span class="p">,</span> <span class="n">sinkfrac</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Distributes a perturbation to dataframe sc and sink</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    src : DataFrame</span>
<span class="sd">        DataFrame of positive sources.</span>
<span class="sd">    sink : DataFrame</span>
<span class="sd">        DataFrame of sinks. Must be all of the same sign. If positive, they are assumed to represent the the magnitude of the (latent) sinks. If they are negative, they are the sink values themselves. Return value will match the convention of the input.</span>
<span class="sd">    net_diff : Series</span>
<span class="sd">        Series representing a perturbation to be distributed proportionally over src and sink. Sign convention agrees with that of src.</span>
<span class="sd">        When net_diff is negative, it augments sink.</span>
<span class="sd">        When it is positive it reduces the sink until sinkfrac fraction of the sink is exhausted, after which the remainder augments the source.</span>
<span class="sd">    sinkfrac : float</span>
<span class="sd">        Fraction of sink that can be reduced in order to achieve the perturbation by reducing the sink. Remainder is applied by augmenting src. Has no effect on time steps when net_diff is negative.</span>
<span class="sd">    debug : bool</span>
<span class="sd">        If True, prints out debug information about the input src and sink DataFrames.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    src : DataFrame</span>
<span class="sd">        DataFrame of adjusted sources, with the same sign convention as the input src.</span>
<span class="sd">    sink : DataFrame</span>
<span class="sd">        DataFrame of adjusted sinks, with the same sign convention as the input sink.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># convert so that sink is a magnitude and switch the sign so that it contributes to sink</span>
    <span class="c1"># deal with magnitudes and in terms of consumptive use as positive,</span>
    <span class="c1"># will undo at the end to match convention of the inputs</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">sink</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">possink</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">haspos</span> <span class="o">=</span> <span class="n">sink</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">sink</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="p">:]</span>
        <span class="n">colswithpos</span> <span class="o">=</span> <span class="p">(</span><span class="n">haspos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="n">hasneg</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">colswithneg</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;test_sink.csv&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;possink&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">sink</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">sink</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="p">:])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sink has all pos values&quot;</span><span class="p">)</span>
        <span class="c1"># SHOULD BE DataFrame of negative sinks</span>
        <span class="n">sink</span> <span class="o">=</span> <span class="o">-</span><span class="n">sink</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">possink</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sink has all neg values&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">src</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">negsrc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">hasneg</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">src</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="p">:]</span>
        <span class="n">colswithneg</span> <span class="o">=</span> <span class="p">(</span><span class="n">hasneg</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="n">hasneg</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">colswithneg</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;test_src.csv&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;negsrc&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">src</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="p">:])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Source has all neg values&quot;</span><span class="p">)</span>
        <span class="c1"># SHOULD BE DataFrame of positive sources</span>
        <span class="n">src</span> <span class="o">=</span> <span class="o">-</span><span class="n">src</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">negsrc</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Source has all pos values&quot;</span><span class="p">)</span>

    <span class="n">src_total</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sink_total</span> <span class="o">=</span> <span class="n">sink</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">dcd_total</span> <span class="o">=</span> <span class="n">src_total</span> <span class="o">+</span> <span class="n">sink_total</span>

    <span class="c1"># Ensure proper formatting of net_diff</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">net_diff</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="n">net_diff</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">net_diff</span> <span class="o">=</span> <span class="n">net_diff</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">net_diff</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">PeriodIndex</span><span class="p">):</span>
        <span class="n">net_diff</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">net_diff</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">()</span>

    <span class="c1"># Create perturbed dataframe for scaling and indexing</span>
    <span class="n">pert</span> <span class="o">=</span> <span class="n">net_diff</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
        <span class="n">dcd_total</span><span class="o">.</span><span class="n">index</span>
    <span class="p">)</span>  <span class="c1"># using only the indices in dcd_total (from the src/sink inputs)</span>
    <span class="c1"># pert</span>
    <span class="n">neg</span> <span class="o">=</span> <span class="n">pert</span> <span class="o">&lt;=</span> <span class="mf">0.0</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="o">~</span><span class="n">neg</span>

    <span class="c1"># For negative (e.g. more depletion) , achieve change by scaling all sinks</span>
    <span class="n">scaleneg</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">sink_total</span> <span class="o">+</span> <span class="n">pert</span>
    <span class="p">)</span> <span class="o">/</span> <span class="n">sink_total</span>  <span class="c1"># all quantities negative, so scaleneg &gt; 1</span>
    <span class="n">scaleneg</span> <span class="o">=</span> <span class="n">scaleneg</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">neg</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># Ensure No effect in pos case</span>

    <span class="c1"># For positive adjustments, remove up to FRAC fraction of total sinks, then ...</span>
    <span class="n">adjustmag</span> <span class="o">=</span> <span class="n">pert</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>  <span class="c1"># total positive adjustment required</span>
    <span class="n">FRAC</span> <span class="o">=</span> <span class="n">sinkfrac</span>
    <span class="n">sinklimit</span> <span class="o">=</span> <span class="o">-</span><span class="n">FRAC</span> <span class="o">*</span> <span class="n">sink_total</span>  <span class="c1"># max amount done by reducing sink (this is pos)</span>
    <span class="n">from_sink</span> <span class="o">=</span> <span class="n">adjustmag</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">upper</span><span class="o">=</span><span class="n">sinklimit</span><span class="p">)</span>
    <span class="n">residual</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">adjustmag</span> <span class="o">-</span> <span class="n">from_sink</span>
    <span class="p">)</span>  <span class="c1"># This should be nonnegative for pertinent cases where ~pos</span>
    <span class="n">residual</span> <span class="o">=</span> <span class="n">residual</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>  <span class="c1"># Just to clarify</span>
    <span class="n">resscale</span> <span class="o">=</span> <span class="p">(</span><span class="n">residual</span> <span class="o">+</span> <span class="n">src_total</span><span class="p">)</span> <span class="o">/</span> <span class="n">src_total</span>
    <span class="n">src</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">resscale</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Now put together the adjustments to sinks under both cases, pos and ~pos</span>
    <span class="n">scalepos</span> <span class="o">=</span> <span class="p">(</span><span class="n">from_sink</span> <span class="o">+</span> <span class="n">sink_total</span><span class="p">)</span> <span class="o">/</span> <span class="n">sink_total</span>  <span class="c1"># for positive (source increase)</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">scalepos</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">scaleneg</span><span class="p">)</span>  <span class="c1"># choose case</span>
    <span class="n">sink</span> <span class="o">=</span> <span class="n">sink</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">possink</span><span class="p">:</span>
        <span class="n">sink</span> <span class="o">=</span> <span class="o">-</span><span class="n">sink</span>
        <span class="c1"># sink.loc[sink==0.] = -0.0</span>
    <span class="k">if</span> <span class="n">negsrc</span><span class="p">:</span>
        <span class="n">src</span> <span class="o">=</span> <span class="o">-</span><span class="n">src</span>
        <span class="c1"># sink.loc[sink==0.] = -0.0</span>

    <span class="c1"># drop NaN&#39;s from interpolations etc.</span>
    <span class="n">sink</span> <span class="o">=</span> <span class="n">sink</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">)</span>
    <span class="n">src</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">src</span><span class="p">,</span> <span class="n">sink</span></div>



<div class="viewcode-block" id="calc_net_diff">
<a class="viewcode-back" href="../../bdschism.html#bdschism.parse_cu.calc_net_diff">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">calc_net_diff</span><span class="p">(</span><span class="n">original_net</span><span class="p">,</span> <span class="n">adjusted_net</span><span class="p">,</span> <span class="n">cfs_to_cms</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the difference in net CU between original and adjusted data in cms.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    original_net: pd.DataFrame</span>
<span class="sd">        DCD net source and sink data from original timeseries.</span>
<span class="sd">        Used to calculate difference in net CU to apply to SCHISM inputs.</span>
<span class="sd">        Entered as a DataFrame with a single column or Series with units of cfs by default.</span>
<span class="sd">    adjusted_net: pd.DataFrame</span>
<span class="sd">        DCD net source and sink data from adjusted timeseries.</span>
<span class="sd">        Used to calculate difference in net CU from original to apply to SCHISM inputs</span>
<span class="sd">        Entered as a DataFrame with a single column or Series with units of cfs by default.</span>
<span class="sd">    cfs_to_cms: bool</span>
<span class="sd">        Set to True if net data is in cfs and needs to be converted to cms for SCHISM.</span>
<span class="sd">        Only set to False if net data is in cms.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.Series</span>
<span class="sd">        Series of the net difference in CU between original and adjusted data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adjusted_net</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="n">adjusted_net</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">adjusted_net</span> <span class="o">=</span> <span class="n">adjusted_net</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="n">common_index</span> <span class="o">=</span> <span class="n">adjusted_net</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">original_net</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">net_diff</span> <span class="o">=</span> <span class="n">adjusted_net</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">common_index</span><span class="p">]</span> <span class="o">-</span> <span class="n">original_net</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">common_index</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">cfs_to_cms</span><span class="p">:</span>
        <span class="n">net_diff</span> <span class="o">=</span> <span class="n">net_diff</span> <span class="o">*</span> <span class="n">CFS2CMS</span>  <span class="c1"># convert to cms</span>

    <span class="k">return</span> <span class="n">net_diff</span></div>



<div class="viewcode-block" id="sch_dcd_net_diff">
<a class="viewcode-back" href="../../bdschism.html#bdschism.parse_cu.sch_dcd_net_diff">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">sch_dcd_net_diff</span><span class="p">(</span>
    <span class="n">net_diff</span><span class="p">,</span>
    <span class="n">schism_vsource</span><span class="p">,</span>
    <span class="n">schism_vsink</span><span class="p">,</span>
    <span class="n">out_dir</span><span class="p">,</span>
    <span class="n">version</span><span class="p">,</span>
    <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">cfs_to_cms</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert adjusted DCD data from DataFrame into SCHISM-ready \*.th inputs.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    net_diff: pd.DataFrame</span>
<span class="sd">        DCD net differences from historical or baseline. Used to apply to SCHISM inputs.</span>
<span class="sd">    schism_vsource: str|Path</span>
<span class="sd">        input SCHISM vsource data, needs to be &quot;dated&quot; and not &quot;elapsed.</span>
<span class="sd">    schism_vsink: str|Path</span>
<span class="sd">        input SCHISM vsink data, needs to be &quot;dated&quot; and not &quot;elapsed.</span>
<span class="sd">    out_dir: str|Path</span>
<span class="sd">        Output directory to store the altered \*.th files.</span>
<span class="sd">    version: str</span>
<span class="sd">        Specifies the tag to put on the output files (e.g. vsource.VERSION.dated.th)</span>
<span class="sd">    start_date: pd.Timestamp, optional</span>
<span class="sd">        Start date for the timeseries.</span>
<span class="sd">    end_date: pd.Timestamp, optional</span>
<span class="sd">        End date for the timeseries.</span>
<span class="sd">    cfs_to_cms: bool, optional</span>
<span class="sd">        Set to True if net data is in cfs and needs to be converted to cms for SCHISM.</span>
<span class="sd">        Only set to False if net data is in cms.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Normalize paths</span>
    <span class="n">schism_vsource</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">schism_vsource</span><span class="p">)</span>
    <span class="n">schism_vsink</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">schism_vsink</span><span class="p">)</span>
    <span class="n">out_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span>

    <span class="c1"># Check inputs first</span>
    <span class="k">if</span> <span class="n">is_elapsed</span><span class="p">(</span><span class="n">schism_vsource</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;SCHISM input is in elapsed format. Needs to be timestamped. File: f</span><span class="si">{</span><span class="n">schism_vsource</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">is_elapsed</span><span class="p">(</span><span class="n">schism_vsink</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;SCHISM input is in elapsed format. Needs to be timestamped. File: f</span><span class="si">{</span><span class="n">schism_vsink</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_dir</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Making directory: </span><span class="si">{</span><span class="n">out_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Read in SCHISM data to net_diff.</span>
    <span class="n">sch_src</span> <span class="o">=</span> <span class="n">read_th</span><span class="p">(</span><span class="n">schism_vsource</span><span class="p">)</span>
    <span class="n">sch_sink</span> <span class="o">=</span> <span class="n">read_th</span><span class="p">(</span><span class="n">schism_vsink</span><span class="p">)</span>
    <span class="n">sch_delta_src</span> <span class="o">=</span> <span class="n">sch_src</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">sch_src</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
    <span class="n">sch_delta_sink</span> <span class="o">=</span> <span class="n">sch_sink</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">sch_sink</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>

    <span class="n">ssrc</span><span class="p">,</span> <span class="n">ssink</span> <span class="o">=</span> <span class="n">adjust_src_sink</span><span class="p">(</span>
        <span class="n">sch_delta_src</span><span class="p">,</span> <span class="n">sch_delta_sink</span><span class="p">,</span> <span class="n">net_diff</span>
    <span class="p">)</span>  <span class="c1"># create the adjusted source/sink values to be used for this version in SCHISM</span>

    <span class="c1"># Add the adjusted columns to the original SCHISM data</span>
    <span class="n">src_out</span> <span class="o">=</span> <span class="n">sch_src</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">src_out</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ssrc</span><span class="p">)</span>
    <span class="n">sink_out</span> <span class="o">=</span> <span class="n">sch_sink</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">sink_out</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ssink</span><span class="p">)</span>
    <span class="n">src_out</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">src_out</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T00:00&quot;</span><span class="p">)</span>
    <span class="n">sink_out</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">sink_out</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T00:00&quot;</span><span class="p">)</span>

    <span class="n">fn_src</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;vsource.</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.dated.th&quot;</span>
    <span class="n">fn_sink</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;vsink.</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.dated.th&quot;</span>

    <span class="c1"># Clip to desired daterange:</span>
    <span class="k">if</span> <span class="n">start_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">src_out</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">end_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">src_out</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">src_out</span> <span class="o">=</span> <span class="n">src_out</span><span class="p">[</span><span class="n">start_date</span><span class="p">:</span><span class="n">end_date</span><span class="p">]</span>
    <span class="n">sink_out</span> <span class="o">=</span> <span class="n">sink_out</span><span class="p">[</span><span class="n">start_date</span><span class="p">:</span><span class="n">end_date</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">src_out</span><span class="o">.</span><span class="n">values</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;There are negative values in the source dataframe! They should all be positive&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing source to </span><span class="si">{</span><span class="n">fn_src</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">src_out</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fn_src</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sink_out</span><span class="o">.</span><span class="n">values</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;There are positive values in the sink dataframe! They should all be negative&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing sink to </span><span class="si">{</span><span class="n">fn_sink</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sink_out</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fn_sink</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="calc_srcsnk_dsm2">
<a class="viewcode-back" href="../../bdschism.html#bdschism.parse_cu.calc_srcsnk_dsm2">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">calc_srcsnk_dsm2</span><span class="p">(</span>
    <span class="n">dcd_dss_file</span><span class="p">,</span>
    <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="n">days</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">exclude_pathname</span><span class="o">=</span><span class="s2">&quot;//TOTAL*/////&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get net source and net sink timeseries from DCD DSS file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dcd_dss_file: str|Path</span>
<span class="sd">        Path to the DCD DSS file. Contains DRAIN-FLOW, SEEP-FLOW, and DIV-FLOW data.</span>
<span class="sd">    start_date: pd.Timestamp, optional</span>
<span class="sd">        Start date for the timeseries.</span>
<span class="sd">    end_date: pd.Timestamp, optional</span>
<span class="sd">        End date for the timeseries.</span>
<span class="sd">    dt: float or pd.DateOffset, optional</span>
<span class="sd">        Time step in days for interpolation.</span>
<span class="sd">    exclude_pathname: str, optional</span>
<span class="sd">        Pathname parts to exclude, ex: &#39;//TOTAL*/////&#39;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    src: pd.Series</span>
<span class="sd">        Series of net source flow in cfs.</span>
<span class="sd">    sink: pd.Series</span>
<span class="sd">        Series of net sink flow in cfs.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dcd_dss_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dcd_dss_file</span><span class="p">)</span>

    <span class="n">df_div_dcd</span> <span class="o">=</span> <span class="n">read_dss</span><span class="p">(</span>
        <span class="n">dcd_dss_file</span><span class="p">,</span>
        <span class="s2">&quot;///DIV-FLOW////&quot;</span><span class="p">,</span>
        <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
        <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
        <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
        <span class="n">exclude_pathname</span><span class="o">=</span><span class="n">exclude_pathname</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">df_seep_dcd</span> <span class="o">=</span> <span class="n">read_dss</span><span class="p">(</span>
        <span class="n">dcd_dss_file</span><span class="p">,</span>
        <span class="s2">&quot;///SEEP-FLOW////&quot;</span><span class="p">,</span>
        <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
        <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
        <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
        <span class="n">exclude_pathname</span><span class="o">=</span><span class="n">exclude_pathname</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">df_drain_dcd</span> <span class="o">=</span> <span class="n">read_dss</span><span class="p">(</span>
        <span class="n">dcd_dss_file</span><span class="p">,</span>
        <span class="s2">&quot;///DRAIN-FLOW////&quot;</span><span class="p">,</span>
        <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
        <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
        <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
        <span class="n">exclude_pathname</span><span class="o">=</span><span class="n">exclude_pathname</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">df_div_dcd</span> <span class="o">=</span> <span class="n">df_div_dcd</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">df_seep_dcd</span> <span class="o">=</span> <span class="n">df_seep_dcd</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="n">df_div_dcd</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">strip_dpart</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_div_dcd</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">df_seep_dcd</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">strip_dpart</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_seep_dcd</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="n">df_drain_dcd</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">strip_dpart</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_drain_dcd</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

    <span class="n">use_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_div_dcd</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s2">&quot;total&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
    <span class="n">df_div_dcd</span> <span class="o">=</span> <span class="n">df_div_dcd</span><span class="p">[</span><span class="n">use_cols</span><span class="p">]</span>
    <span class="n">use_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_seep_dcd</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s2">&quot;total&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
    <span class="n">df_seep_dcd</span> <span class="o">=</span> <span class="n">df_seep_dcd</span><span class="p">[</span><span class="n">use_cols</span><span class="p">]</span>
    <span class="n">use_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_drain_dcd</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s2">&quot;total&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
    <span class="n">df_drain_dcd</span> <span class="o">=</span> <span class="n">df_drain_dcd</span><span class="p">[</span><span class="n">use_cols</span><span class="p">]</span>

    <span class="n">src</span> <span class="o">=</span> <span class="n">df_drain_dcd</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sink</span> <span class="o">=</span> <span class="n">df_div_dcd</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">df_seep_dcd</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">src</span><span class="p">,</span> <span class="n">sink</span></div>



<div class="viewcode-block" id="calc_net_dsm2">
<a class="viewcode-back" href="../../bdschism.html#bdschism.parse_cu.calc_net_dsm2">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">calc_net_dsm2</span><span class="p">(</span>
    <span class="n">dcd_dss_file</span><span class="p">,</span>
    <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="n">days</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">exclude_pathname</span><span class="o">=</span><span class="s2">&quot;//TOTAL*/////&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get net timeseries from DCD DSS file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dcd_dss_file: str|Path</span>
<span class="sd">        Path to the DCD DSS file. Contains DRAIN-FLOW, SEEP-FLOW, and DIV-FLOW data.</span>
<span class="sd">    start_date: pd.Timestamp, optional</span>
<span class="sd">        Start date for the timeseries.</span>
<span class="sd">    end_date: pd.Timestamp, optional</span>
<span class="sd">        End date for the timeseries.</span>
<span class="sd">    dt: float or pd.DateOffset, optional</span>
<span class="sd">        Time step in days for interpolation.</span>
<span class="sd">    exclude_pathname: str, optional</span>
<span class="sd">        Pathname parts to exclude, ex: &#39;//TOTAL*/////&#39;</span>
<span class="sd">    kwargs: dict, optional</span>
<span class="sd">        Additional keyword arguments to pass to the read_dss function. (unused in this function)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.Series</span>
<span class="sd">        Series of net consumptive use in cfs, calculated as source - sink.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dcd_dss_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dcd_dss_file</span><span class="p">)</span>

    <span class="n">src</span><span class="p">,</span> <span class="n">sink</span> <span class="o">=</span> <span class="n">calc_srcsnk_dsm2</span><span class="p">(</span>
        <span class="n">dcd_dss_file</span><span class="p">,</span>
        <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
        <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
        <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
        <span class="n">exclude_pathname</span><span class="o">=</span><span class="n">exclude_pathname</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">src</span> <span class="o">-</span> <span class="n">sink</span></div>



<div class="viewcode-block" id="calc_net_calsim">
<a class="viewcode-back" href="../../bdschism.html#bdschism.parse_cu.calc_net_calsim">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">calc_net_calsim</span><span class="p">(</span>
    <span class="n">dcd_dss_calsim</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">days</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get net consumptive use timeseries from Calsim DSS file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dcd_dss_calsim: str|Path</span>
<span class="sd">        Path to the Calsim DSS file. Contains DICU_FLOW data.</span>
<span class="sd">    start_date: pd.Timestamp, optional</span>
<span class="sd">        Start date for the timeseries.</span>
<span class="sd">    end_date: pd.Timestamp, optional</span>
<span class="sd">        End date for the timeseries.</span>
<span class="sd">    dt: float or pd.DateOffset, optional</span>
<span class="sd">        Time step in days for interpolation.</span>
<span class="sd">    kwargs: dict, optional</span>
<span class="sd">        Additional keyword arguments to pass to the read_dss function. (unused in this function)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        DataFrame with a single column named &#39;net&#39; containing net consumptive use in cfs.</span>
<span class="sd">        The data is read from the DICU_FLOW path in the Calsim DSS file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dcd_dss_calsim</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dcd_dss_calsim</span><span class="p">)</span>

    <span class="n">net</span> <span class="o">=</span> <span class="n">read_dss</span><span class="p">(</span>
        <span class="n">dcd_dss_calsim</span><span class="p">,</span>
        <span class="s2">&quot;///DICU_FLOW////&quot;</span><span class="p">,</span>
        <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
        <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
        <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">net</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;net&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="n">net</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">net</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="o">-</span><span class="n">net</span></div>



<div class="viewcode-block" id="calc_net_obs_schism">
<a class="viewcode-back" href="../../bdschism.html#bdschism.parse_cu.calc_net_obs_schism">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">calc_net_obs_schism</span><span class="p">(</span>
    <span class="n">schism_dir</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">days</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use the repository to calculate net SCHISM DCU&quot;&quot;&quot;</span>

    <span class="n">schism_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bds_dir</span><span class="p">,</span> <span class="s2">&quot;data/channel_depletion/&quot;</span><span class="p">))</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;vsource&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;vsource_dated.th&quot;</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;vsink&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;vsink_dated.th&quot;</span>

    <span class="n">net</span> <span class="o">=</span> <span class="n">calc_net_schism</span><span class="p">(</span>
        <span class="n">schism_dir</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">net</span></div>



<div class="viewcode-block" id="calc_net_schism">
<a class="viewcode-back" href="../../bdschism.html#bdschism.parse_cu.calc_net_schism">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">calc_net_schism</span><span class="p">(</span><span class="n">schism_dir</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">days</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get net timeseries from SCHISM th files in cfs.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    schism_dir: str|Path</span>
<span class="sd">        SCHISM directory where vsource.th and vsink.th files are found.</span>
<span class="sd">    start_date: pd.Timestamp, optional</span>
<span class="sd">        Start date for the timeseries.</span>
<span class="sd">    end_date: pd.Timestamp, optional</span>
<span class="sd">        End date for the timeseries.</span>
<span class="sd">    dt: float or pd.DateOffset, optional</span>
<span class="sd">        Time step in days for interpolation.</span>
<span class="sd">    kwargs: dict, optional</span>
<span class="sd">        Additional keyword arguments to pass to the SCHISM net calculation functions.</span>
<span class="sd">        For example, if the original data has a specific vsource file, you can pass</span>
<span class="sd">        ``vsource_original=&#39;vsource_dated.th&#39;`` and it will be used in the calculation.</span>
<span class="sd">        You must use _original or _perturbed suffixes to distinguish between original and perturbed data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        DataFrame with a single column named &#39;net&#39; containing net consumptive use in cfs.</span>
<span class="sd">        The data is calculated from the vsource and vsink files in the SCHISM directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">schism_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">schism_dir</span><span class="p">)</span>

    <span class="n">vsource</span> <span class="o">=</span> <span class="n">schism_dir</span> <span class="o">/</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vsource&quot;</span><span class="p">)</span>
    <span class="n">vsink</span> <span class="o">=</span> <span class="n">schism_dir</span> <span class="o">/</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vsink&quot;</span><span class="p">)</span>

    <span class="n">net</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">sink</span> <span class="o">=</span> <span class="n">calc_net_source_sink</span><span class="p">(</span>
        <span class="n">vsource_file</span><span class="o">=</span><span class="n">vsource</span><span class="p">,</span>
        <span class="n">vsink_file</span><span class="o">=</span><span class="n">vsink</span><span class="p">,</span>
        <span class="n">search_term</span><span class="o">=</span><span class="s2">&quot;delta&quot;</span><span class="p">,</span>
        <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
        <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
        <span class="n">net</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_period</span><span class="p">()</span>

    <span class="n">net</span> <span class="o">=</span> <span class="n">rhistinterp</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
    <span class="n">net</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;net&quot;</span><span class="p">]</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">net</span> <span class="o">*</span> <span class="n">CMS2CFS</span>  <span class="c1"># convert to cfs</span>

    <span class="k">return</span> <span class="n">net</span></div>



<div class="viewcode-block" id="read_net_csv">
<a class="viewcode-back" href="../../bdschism.html#bdschism.parse_cu.read_net_csv">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_net_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">days</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read net timeseries from a CSV file.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    csv_file: str|Path</span>
<span class="sd">        Path to the CSV file containing net consumptive use data.</span>
<span class="sd">    start_date: pd.Timestamp, optional</span>
<span class="sd">        Start date for the timeseries.</span>
<span class="sd">    end_date: pd.Timestamp, optional</span>
<span class="sd">        End date for the timeseries.</span>
<span class="sd">    dt: float or pd.DateOffset, optional</span>
<span class="sd">        Time step in days for interpolation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">csv_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">csv_file</span><span class="p">)</span>

    <span class="n">net</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">col</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;col&quot;</span><span class="p">]</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">net</span><span class="p">[[</span><span class="n">col</span><span class="p">]]</span>

    <span class="c1"># clip to time constraint</span>
    <span class="k">if</span> <span class="n">start_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">end_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">end_date</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="n">net</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;File: </span><span class="si">{</span><span class="n">csv_file</span><span class="si">}</span><span class="s2"> does not cover the dates requested. </span><span class="se">\n\t</span><span class="s2">Requested dates are: </span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">, </span><span class="se">\n\t</span><span class="s2">and the file covers </span><span class="si">{</span><span class="n">net</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">net</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">net</span><span class="p">[</span><span class="n">start_date</span><span class="p">:</span><span class="n">end_date</span><span class="p">]</span>

    <span class="c1"># Resample to daily frequency</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span>

    <span class="c1"># Convert DatetimeIndex to PeriodIndex if needed</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
        <span class="n">net</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">)</span>

    <span class="c1"># Convert to cfs if needed</span>
    <span class="k">if</span> <span class="s2">&quot;cms_to_cfs&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;cms_to_cfs&quot;</span><span class="p">]:</span>
            <span class="n">net</span> <span class="o">=</span> <span class="n">net</span> <span class="o">*</span> <span class="n">CMS2CFS</span>  <span class="c1"># convert to cfs</span>

    <span class="n">net</span> <span class="o">=</span> <span class="n">rhistinterp</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
    <span class="n">net</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;net&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">net</span></div>



<span class="c1"># Map type string to function</span>
<span class="n">SRC_SNK_FUNC_MAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;dsm2&quot;</span><span class="p">:</span> <span class="n">calc_net_dsm2</span><span class="p">,</span>
    <span class="s2">&quot;calsim&quot;</span><span class="p">:</span> <span class="n">calc_net_calsim</span><span class="p">,</span>
    <span class="s2">&quot;schism&quot;</span><span class="p">:</span> <span class="n">calc_net_schism</span><span class="p">,</span>
    <span class="s2">&quot;obs_schism&quot;</span><span class="p">:</span> <span class="n">calc_net_obs_schism</span><span class="p">,</span>
    <span class="s2">&quot;csv&quot;</span><span class="p">:</span> <span class="n">read_net_csv</span><span class="p">,</span>
    <span class="c1"># add more types as needed</span>
<span class="p">}</span>


<div class="viewcode-block" id="strip_dpart">
<a class="viewcode-back" href="../../bdschism.html#bdschism.parse_cu.strip_dpart">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">strip_dpart</span><span class="p">(</span><span class="n">colname</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove the 5th part of a DSS path, which is the D part.</span>
<span class="sd">    This is used to strip the D part from the column names in the DCD data.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    colname: str</span>
<span class="sd">        The column name in the DSS path format.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The column name with the D part removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">colname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span></div>



<span class="c1"># Main function</span>
<div class="viewcode-block" id="orig_pert_to_schism_dcd">
<a class="viewcode-back" href="../../bdschism.html#bdschism.parse_cu.orig_pert_to_schism_dcd">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">orig_pert_to_schism_dcd</span><span class="p">(</span>
    <span class="n">original_type</span><span class="p">,</span>
    <span class="n">original_filename</span><span class="p">,</span>
    <span class="n">perturbed_type</span><span class="p">,</span>
    <span class="n">perturbed_filename</span><span class="p">,</span>
    <span class="n">schism_vsource</span><span class="p">,</span>
    <span class="n">schism_vsink</span><span class="p">,</span>
    <span class="n">out_dir</span><span class="p">,</span>
    <span class="n">version</span><span class="p">,</span>
    <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="n">days</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert original and perturbed DCD data to SCHISM vsource and vsink inputs.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    original_type: str</span>
<span class="sd">        Type of the original DCD data (e.g. &#39;dsm2&#39;, &#39;calsim&#39;, &#39;csv&#39;, &#39;schism&#39;).</span>
<span class="sd">    original_filename: str|Path</span>
<span class="sd">        Path to the original DCD data file. If DSS then enter the filename.</span>
<span class="sd">        If SCHISM then enter the directory where vsource.th and vsink.th are found.</span>
<span class="sd">    perturbed_type: str</span>
<span class="sd">        Type of the perturbed DCD data (e.g. &#39;dsm2&#39;, &#39;calsim&#39;, &#39;csv&#39;, &#39;schism&#39;).</span>
<span class="sd">    perturbed_filename: str|Path</span>
<span class="sd">        Path to the perturbed DCD data file. If DSS then enter the filename.</span>
<span class="sd">        If SCHISM then enter the directory where vsource.th and vsink.th are found.</span>
<span class="sd">    schism_vsource: str|Path</span>
<span class="sd">        Input SCHISM vsource data, needs to be &#39;dated&#39; and not &#39;elapsed&#39;.</span>
<span class="sd">    schism_vsink: str|Path</span>
<span class="sd">        Input SCHISM vsink data, needs to be &#39;dated&#39; and not &#39;elapsed&#39;.</span>
<span class="sd">    out_dir: str|Path</span>
<span class="sd">        Output directory to store the altered \*.th files.</span>
<span class="sd">    version: str</span>
<span class="sd">        Specifies the tag to put on the output files (e.g. vsource.VERSION.dated.th).</span>
<span class="sd">    start_date: pd.Timestamp, optional</span>
<span class="sd">        Start date for the timeseries. If None, uses the start date from the original data.</span>
<span class="sd">    end_date: pd.Timestamp, optional</span>
<span class="sd">        End date for the timeseries. If None, uses the end date from the original data.</span>
<span class="sd">    dt: float or pd.DateOffset, optional</span>
<span class="sd">        Time step in days for interpolation. Default is 1 day.</span>
<span class="sd">    **kwargs: dict</span>
<span class="sd">        Additional keyword arguments to pass to the SCHISM net calculation functions.</span>
<span class="sd">        For example, if the original data has a specific vsource file, you can pass</span>
<span class="sd">        vsource_original=&#39;vsource_dated.th&#39; and it will be used in the calculation.</span>
<span class="sd">        You must use _original or _perturbed suffixes to distinguish between original and perturbed data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">original_filename</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">original_filename</span><span class="p">)</span>
    <span class="n">perturbed_filename</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">perturbed_filename</span><span class="p">)</span>
    <span class="n">schism_vsource</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">schism_vsource</span><span class="p">)</span>
    <span class="n">schism_vsink</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">schism_vsink</span><span class="p">)</span>
    <span class="n">out_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span>

    <span class="c1"># Read in DSS data and compute net difference in the original case</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading Original DCD data from </span><span class="si">{</span><span class="n">original_type</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> inputs...&quot;</span><span class="p">)</span>
    <span class="n">original_fxn</span> <span class="o">=</span> <span class="n">SRC_SNK_FUNC_MAP</span><span class="p">[</span>
        <span class="n">original_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="p">]</span>  <span class="c1"># original net flow for source/sink</span>
    <span class="c1"># Look for &#39;original&#39; in kwargs and pass to original_fxn</span>
    <span class="n">original_kwargs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_original&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;original&quot;</span> <span class="ow">in</span> <span class="n">k</span>
    <span class="p">}</span>
    <span class="n">net_original</span> <span class="o">=</span> <span class="n">original_fxn</span><span class="p">(</span>
        <span class="n">original_filename</span><span class="p">,</span>
        <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
        <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
        <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
        <span class="o">**</span><span class="n">original_kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;sign_flip&quot;</span> <span class="ow">in</span> <span class="n">original_kwargs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">original_kwargs</span><span class="p">[</span><span class="s2">&quot;sign_flip&quot;</span><span class="p">]:</span>
            <span class="n">net_original</span> <span class="o">=</span> <span class="o">-</span><span class="n">net_original</span>

    <span class="c1"># Read in DSS data and compute net difference in the perturbed case</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading Perturbed DCD data from </span><span class="si">{</span><span class="n">perturbed_type</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> inputs...&quot;</span><span class="p">)</span>
    <span class="n">perturbed_fxn</span> <span class="o">=</span> <span class="n">SRC_SNK_FUNC_MAP</span><span class="p">[</span>
        <span class="n">perturbed_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="p">]</span>  <span class="c1"># perturbed net flow for source/sink</span>
    <span class="n">perturbed_kwargs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_perturbed&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;perturbed&quot;</span> <span class="ow">in</span> <span class="n">k</span>
    <span class="p">}</span>
    <span class="n">net_perturbed</span> <span class="o">=</span> <span class="n">perturbed_fxn</span><span class="p">(</span>
        <span class="n">perturbed_filename</span><span class="p">,</span>
        <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
        <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
        <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
        <span class="o">**</span><span class="n">perturbed_kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;sign_flip&quot;</span> <span class="ow">in</span> <span class="n">perturbed_kwargs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">perturbed_kwargs</span><span class="p">[</span><span class="s2">&quot;sign_flip&quot;</span><span class="p">]:</span>
            <span class="n">net_perturbed</span> <span class="o">=</span> <span class="o">-</span><span class="n">net_perturbed</span>

    <span class="c1"># Calculate the net difference between original and perturbed</span>
    <span class="n">net_diff</span> <span class="o">=</span> <span class="n">calc_net_diff</span><span class="p">(</span>
        <span class="n">net_original</span><span class="p">,</span>
        <span class="n">net_perturbed</span><span class="p">,</span>
        <span class="n">cfs_to_cms</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>  <span class="c1"># net difference in cms</span>

    <span class="c1"># Apply differences to SCHISM inputs</span>
    <span class="n">sch_dcd_net_diff</span><span class="p">(</span>
        <span class="n">net_diff</span><span class="p">,</span>
        <span class="n">schism_vsource</span><span class="p">,</span>
        <span class="n">schism_vsink</span><span class="p">,</span>
        <span class="n">out_dir</span><span class="p">,</span>
        <span class="n">version</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="orig_pert_to_schism_dcd_yaml">
<a class="viewcode-back" href="../../bdschism.html#bdschism.parse_cu.orig_pert_to_schism_dcd_yaml">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">orig_pert_to_schism_dcd_yaml</span><span class="p">(</span><span class="n">yaml_fn</span><span class="p">,</span> <span class="n">envvar</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert original and perturbed DCD data to SCHISM vsource and vsink inputs from yaml input file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    yaml_fn: str|Path</span>
<span class="sd">        Path to the YAML file containing configuration.</span>
<span class="sd">    envvar: dict or None, optional</span>
<span class="sd">        Optional dictionary of environment variables or overrides. If None, no overrides are applied.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">yaml_content</span> <span class="o">=</span> <span class="n">yaml_from_file</span><span class="p">(</span><span class="n">yaml_fn</span><span class="p">,</span> <span class="n">envvar</span><span class="o">=</span><span class="n">envvar</span><span class="p">)</span>

    <span class="n">cu_inputs</span> <span class="o">=</span> <span class="n">yaml_content</span><span class="p">[</span><span class="s2">&quot;cu&quot;</span><span class="p">]</span>

    <span class="c1"># Build a dict of all arguments, with envvar overriding cu_inputs</span>
    <span class="n">all_args</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">cu_inputs</span><span class="p">,</span> <span class="o">**</span><span class="p">(</span><span class="n">envvar</span> <span class="ow">or</span> <span class="p">{})}</span>
    <span class="c1"># Remove process key if present (not an argument for orig_pert_to_schism_dcd)</span>
    <span class="n">all_args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;process&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Optionals from envvar or default</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">cu_inputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">cu_inputs</span> <span class="ow">and</span> <span class="s2">&quot;start_date&quot;</span> <span class="ow">in</span> <span class="n">cu_inputs</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">cu_inputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_date&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">cu_inputs</span> <span class="ow">and</span> <span class="s2">&quot;end_date&quot;</span> <span class="ow">in</span> <span class="n">cu_inputs</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">cu_inputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dt&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">cu_inputs</span> <span class="ow">and</span> <span class="s2">&quot;dt&quot;</span> <span class="ow">in</span> <span class="n">cu_inputs</span> <span class="k">else</span> <span class="n">days</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">cfs_to_cms</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">cu_inputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cfs_to_cms&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">cu_inputs</span> <span class="ow">and</span> <span class="s2">&quot;cfs_to_cms&quot;</span> <span class="ow">in</span> <span class="n">cu_inputs</span> <span class="k">else</span> <span class="kc">True</span>
    <span class="p">)</span>
    <span class="c1"># Remove any duplicate keys that are not needed</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">,</span> <span class="s2">&quot;dt&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">all_args</span> <span class="ow">and</span> <span class="nb">locals</span><span class="p">()[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">all_args</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()[</span><span class="n">k</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">cu_inputs</span><span class="p">[</span><span class="s2">&quot;process&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;orig_pert_to_schism&quot;</span><span class="p">:</span>
        <span class="c1"># Required arguments</span>
        <span class="n">required_keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;original_type&quot;</span><span class="p">,</span>
            <span class="s2">&quot;original_filename&quot;</span><span class="p">,</span>
            <span class="s2">&quot;perturbed_type&quot;</span><span class="p">,</span>
            <span class="s2">&quot;perturbed_filename&quot;</span><span class="p">,</span>
            <span class="s2">&quot;schism_vsource&quot;</span><span class="p">,</span>
            <span class="s2">&quot;schism_vsink&quot;</span><span class="p">,</span>
            <span class="s2">&quot;out_dir&quot;</span><span class="p">,</span>
            <span class="s2">&quot;version&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">required_keys</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cu_inputs</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Missing required keys in cu_inputs: </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="se">\n\t</span><span class="s2">All keys needed are: </span><span class="si">{</span><span class="n">required_keys</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">orig_pert_to_schism_dcd</span><span class="p">(</span><span class="o">**</span><span class="n">all_args</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">cu_inputs</span><span class="p">[</span><span class="s2">&quot;process&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;net_diff_to_schism&quot;</span><span class="p">:</span>
        <span class="c1"># Required arguments</span>
        <span class="n">required_keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;net_diff_filename&quot;</span><span class="p">,</span>
            <span class="s2">&quot;schism_vsource&quot;</span><span class="p">,</span>
            <span class="s2">&quot;schism_vsink&quot;</span><span class="p">,</span>
            <span class="s2">&quot;out_dir&quot;</span><span class="p">,</span>
            <span class="s2">&quot;version&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">required_keys</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cu_inputs</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Missing required keys in cu_inputs: </span><span class="si">{</span><span class="n">missing</span><span class="si">}</span><span class="se">\n\t</span><span class="s2">All keys needed are: </span><span class="si">{</span><span class="n">required_keys</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Read net difference from the specified file</span>
        <span class="n">net_diff</span> <span class="o">=</span> <span class="n">read_net_csv</span><span class="p">(</span>
            <span class="n">cu_inputs</span><span class="p">[</span><span class="s2">&quot;net_diff_filename&quot;</span><span class="p">],</span>
            <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
            <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
            <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">sch_dcd_net_diff</span><span class="p">(</span>
            <span class="n">net_diff</span><span class="p">,</span>
            <span class="n">cu_inputs</span><span class="p">[</span><span class="s2">&quot;schism_vsource&quot;</span><span class="p">],</span>
            <span class="n">cu_inputs</span><span class="p">[</span><span class="s2">&quot;schism_vsink&quot;</span><span class="p">],</span>
            <span class="n">cu_inputs</span><span class="p">[</span><span class="s2">&quot;out_dir&quot;</span><span class="p">],</span>
            <span class="n">cu_inputs</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">],</span>
            <span class="n">cfs_to_cms</span><span class="o">=</span><span class="n">cfs_to_cms</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unknown process </span><span class="si">{</span><span class="n">cu_inputs</span><span class="p">[</span><span class="s1">&#39;process&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> in cu_inputs. &quot;</span>
            <span class="s2">&quot;Expected &#39;orig_pert_to_schism&#39; or &#39;net_diff_to_schism&#39;.&quot;</span>
        <span class="p">)</span></div>



<span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">(</span>
    <span class="n">help</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;Transfer hotstart data from one grid to another&#39;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Arguments:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;  YAML  Path to the YAML file.&quot;</span>
        <span class="s2">&quot;For instance hotstart_from_hotstart.yaml (found in examples/hotstart/examples)&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span><span class="s2">&quot;yaml_fn&quot;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">help_option</span><span class="p">(</span><span class="s2">&quot;-h&quot;</span><span class="p">,</span> <span class="s2">&quot;--help&quot;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span><span class="s2">&quot;extra&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">parse_cu_yaml_cli</span><span class="p">(</span>
    <span class="n">yaml_fn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">extra</span><span class="o">=</span><span class="p">(),</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Command-line interface for transferring hotstart data from one grid to another.</span>
<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">        yaml_fn      Path to the YAML file (e.g., parse_cu.yaml).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Parse extra arguments into a dictionary (expects --key value pairs)</span>
    <span class="n">envvar</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">key</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">extra</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;--&quot;</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">envvar</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
            <span class="n">key</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No value provided for extra argument: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">orig_pert_to_schism_dcd_yaml</span><span class="p">(</span><span class="n">yaml_fn</span><span class="p">,</span> <span class="n">envvar</span><span class="o">=</span><span class="n">envvar</span> <span class="k">if</span> <span class="n">envvar</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>


<span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">(</span>
    <span class="n">help</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;Uses consumptive use adjustments to historical data &quot;</span>
        <span class="s2">&quot;in order to determine what the adjusted values for vsource.th and vsink.th are&quot;</span>
        <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Example Usages:&quot;</span>
        <span class="s2">&quot;</span><span class="se">\n\n\t</span><span class="s2">bds parse_cu dsm2 ./dsm2/DCD_hist_Lch5.dss calsim ./calsim/DCR2023_DV_9.3.1_v2a_Danube_Adj_v1.8.dss ./schism/vsource_dated.th ./schism/vsink_dated.th ./out_dir dsm2_calsim_v1&quot;</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">bds parse_cu schism ./schism/ dsm2 ./dsm2/DCD_hist_Lch5.dss ./schism/simulation/vsource_dated.th ./schism/simulation/vsink_dated.th ./out_dir schism_dsm2_v1 --param vsource_original vsource_2023.th vsink_original vsink_2023.th&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">help_option</span><span class="p">(</span><span class="s2">&quot;-h&quot;</span><span class="p">,</span> <span class="s2">&quot;--help&quot;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span>
    <span class="s2">&quot;original_type&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="s2">&quot;dsm2&quot;</span><span class="p">,</span> <span class="s2">&quot;calsim&quot;</span><span class="p">,</span> <span class="s2">&quot;csv&quot;</span><span class="p">,</span> <span class="s2">&quot;schism&quot;</span><span class="p">],</span> <span class="n">case_sensitive</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span>
    <span class="s2">&quot;original_filename&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span>
    <span class="s2">&quot;perturbed_type&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="s2">&quot;dsm2&quot;</span><span class="p">,</span> <span class="s2">&quot;calsim&quot;</span><span class="p">,</span> <span class="s2">&quot;csv&quot;</span><span class="p">,</span> <span class="s2">&quot;schism&quot;</span><span class="p">],</span> <span class="n">case_sensitive</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span>
    <span class="s2">&quot;perturbed_filename&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span><span class="s2">&quot;schism_vsource&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span><span class="s2">&quot;schism_vsink&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span><span class="s2">&quot;out_dir&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">())</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">argument</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--start-date&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">DateTime</span><span class="p">(</span><span class="n">formats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">]),</span>
    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Start date (YYYY-MM-DD)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--end-date&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">DateTime</span><span class="p">(</span><span class="n">formats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">]),</span>
    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;End date (YYYY-MM-DD)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--dt&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Time step in days.&quot;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s2">&quot;--param&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
    <span class="n">multiple</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;Extra key-value parameters to pass to the net calculation functions, &quot;</span>
        <span class="s2">&quot;e.g. --param vsource_original vsource_dated.th vsource_perturbed vsource_2023.th&quot;</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">parse_cu_cli</span><span class="p">(</span>
    <span class="n">original_type</span><span class="p">,</span>
    <span class="n">original_filename</span><span class="p">,</span>
    <span class="n">perturbed_type</span><span class="p">,</span>
    <span class="n">perturbed_filename</span><span class="p">,</span>
    <span class="n">schism_vsource</span><span class="p">,</span>
    <span class="n">schism_vsink</span><span class="p">,</span>
    <span class="n">out_dir</span><span class="p">,</span>
    <span class="n">version</span><span class="p">,</span>
    <span class="n">start_date</span><span class="p">,</span>
    <span class="n">end_date</span><span class="p">,</span>
    <span class="n">dt</span><span class="p">,</span>
    <span class="n">param</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main entry point for consumptive use - SCHISM commands.</span>
<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    original_type : str</span>
<span class="sd">        Type of the original DCD data (e.g. &#39;dsm2&#39;, &#39;calsim&#39;, &#39;csv&#39;, &#39;schism&#39;).</span>
<span class="sd">    original_filename : str</span>
<span class="sd">        Path to the original DCD data file. If DSS then enter the filename.</span>
<span class="sd">        If SCHISM then enter the directory where vsource.th and vsink.th are found.</span>
<span class="sd">    perturbed_type : str</span>
<span class="sd">        Type of the perturbed DCD data (e.g. &#39;dsm2&#39;, &#39;calsim&#39;, &#39;csv&#39;, &#39;schism&#39;).</span>
<span class="sd">    perturbed_filename : str</span>
<span class="sd">        Path to the perturbed DCD data file. If DSS then enter the filename.</span>
<span class="sd">        If SCHISM then enter the directory where vsource.th and vsink.th are found.</span>
<span class="sd">    schism_vsource : str</span>
<span class="sd">        Input SCHISM vsource data, needs to be &quot;dated&quot; and not &quot;elapsed&quot;.</span>
<span class="sd">    schism_vsink : str</span>
<span class="sd">        Input SCHISM vsink data, needs to be &quot;dated&quot; and not &quot;elapsed&quot;.</span>
<span class="sd">    out_dir : str</span>
<span class="sd">        Output directory to store the altered *.th files.</span>
<span class="sd">    version : str</span>
<span class="sd">        Specifies the tag to put on the output files (e.g. vsource.VERSION.dated.th).</span>

<span class="sd">    Options</span>
<span class="sd">    -------</span>
<span class="sd">    --start-date : str</span>
<span class="sd">        Start date (YYYY-MM-DD).</span>
<span class="sd">    --end-date : str</span>
<span class="sd">        End date (YYYY-MM-DD).</span>
<span class="sd">    --dt : int</span>
<span class="sd">        Time step in days.</span>
<span class="sd">    --param : (str, str)</span>
<span class="sd">        Extra key-value parameters to pass to the net calculation functions.</span>
<span class="sd">        e.g. --param vsource_original vsource_dated.th vsource_perturbed vsource_2023.th</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert paths to Path objects</span>
    <span class="n">original_filename</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">original_filename</span><span class="p">)</span>
    <span class="n">perturbed_filename</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">perturbed_filename</span><span class="p">)</span>
    <span class="n">schism_vsource</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">schism_vsource</span><span class="p">)</span>
    <span class="n">schism_vsink</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">schism_vsink</span><span class="p">)</span>
    <span class="n">out_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span>
    <span class="c1"># Ensure out_dir exists</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating output directory: </span><span class="si">{</span><span class="n">out_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">out_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Convert param tuples to a dict</span>
    <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="c1"># Pass extra_kwargs to orig_pert_to_schism_dcd</span>
    <span class="n">orig_pert_to_schism_dcd</span><span class="p">(</span>
        <span class="n">original_type</span><span class="p">,</span>
        <span class="n">original_filename</span><span class="p">,</span>
        <span class="n">perturbed_type</span><span class="p">,</span>
        <span class="n">perturbed_filename</span><span class="p">,</span>
        <span class="n">schism_vsource</span><span class="p">,</span>
        <span class="n">schism_vsink</span><span class="p">,</span>
        <span class="n">out_dir</span><span class="p">,</span>
        <span class="n">version</span><span class="p">,</span>
        <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
        <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
        <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
        <span class="o">**</span><span class="n">extra_kwargs</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">parse_cu_cli</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2014,2020 California Department of Water Resources.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: white;
    }
    /* Sidebar */
    .wy-nav-side {
      background: #86989B; /* existing theme was AFC1C4 and 86989B and CA7900 and white */
      
    }
  </style>


</body>
</html>