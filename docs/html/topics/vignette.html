
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vignette: Hindcast Bay Delta SCHISM at Delta Modeling Section with Preprocessor &#8212; Bay-Delta SCHISM</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinxdoc.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Study Templates and Preprocessing" href="preprocess.html" />
    <link rel="prev" title="Overview of Basic Bay-Delta SCHISM Run" href="overview.html" /> 
  </head><body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../index.html"><img src="../_static/logo6.png" border="0" alt="Bay-Delta SCHISM"/></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="preprocess.html" title="Study Templates and Preprocessing"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="Overview of Basic Bay-Delta SCHISM Run"
             accesskey="P">previous</a> |</li>
        <li><a href="https://water.ca.gov/Library/Modeling-and-Analysis/Bay-Delta-Region-models-and-tools"> Delta Modeling Section</a>|&nbsp;</li>
        <li><a href="https://github.com/CADWRDeltaModeling">GitHub</a>|&nbsp;</li>
        <li><a href="../search.html">Search</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="../learning.html" >Learning Resources for Bay-Delta SCHISM</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../topical_guide.html" accesskey="U">Bay-Delta SCHISM Topical Guide</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Vignette: Hindcast Bay Delta SCHISM at Delta Modeling Section with Preprocessor</a></li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/dwr_logo_small.png" alt="Logo"/>
            </a></p>
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Vignette: Hindcast Bay Delta SCHISM at Delta Modeling Section with Preprocessor</a><ul>
<li><a class="reference internal" href="#windows">Windows</a></li>
<li><a class="reference internal" href="#linux">Linux</a><ul>
<li><a class="reference internal" href="#barotropic">Barotropic</a></li>
<li><a class="reference internal" href="#baroclinic">Baroclinic</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="overview.html"
                          title="previous chapter">Overview of Basic Bay-Delta SCHISM Run</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="preprocess.html"
                          title="next chapter">Study Templates and Preprocessing</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/topics/vignette.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="vignette-hindcast-bay-delta-schism-at-delta-modeling-section-with-preprocessor">
<span id="bdschinstr"></span><h1>Vignette: Hindcast Bay Delta SCHISM at Delta Modeling Section with Preprocessor<a class="headerlink" href="#vignette-hindcast-bay-delta-schism-at-delta-modeling-section-with-preprocessor" title="Permalink to this heading">¶</a></h1>
<p>The process for starting a Bay Delta SCHISM run from scratch involves some pre-processing work on a Windows machine using the schimpy library (<a class="reference external" href="https://github.com/CADWRDeltaModeling/schimpy">https://github.com/CADWRDeltaModeling/schimpy</a>).</p>
<p>You’ll want to have a conda environment which has the latest version of schimpy in it. For this example that environment is called ‘schism’.</p>
<div class="section" id="windows">
<h2>Windows<a class="headerlink" href="#windows" title="Permalink to this heading">¶</a></h2>
<ol class="arabic">
<li><p>Clone the Bay Delta Schism repository to your Windows machine (ex: D:/schism/bdsch_scratch)</p>
<ul class="simple">
<li><p>git clone <a class="reference external" href="https://github.com/CADWRDeltaModeling/BayDeltaSCHISM.git">https://github.com/CADWRDeltaModeling/BayDeltaSCHISM.git</a> (creates a BayDeltaSCHISM folder within bdsch_scratch)</p></li>
<li><p>if already cloned, then pull updates to the repository</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">git pull</span>
</pre></div>
</div>
</li>
<li><p>Create a directory on Windows where you’ll build model inputs (“./baydeltainputs”) and copy the following files into it:</p>
<ul>
<li><dl class="simple">
<dt>From “./BayDeltaSCHISM”:</dt><dd><ul class="simple">
<li><p>“./BayDeltaSCHISM/templates/bay_delta” folder contents</p></li>
<li><p>“./BayDeltaSCHISM/data/flow_station_xsects.yaml”</p></li>
<li><p>“./BayDeltaSCHISM/data/stations” folder contents</p></li>
<li><p>“./BayDeltaSCHISM/scripts/multi_clip.py”</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>You’ll need a .2dm file for the pre-processor, copy this into the baydeltainputs folder</p></li>
<li><dl>
<dt>Need launch.pbs files</dt><dd><ul>
<li><p>launch.tropic.pbs</p></li>
<li><dl>
<dt>launch.clinic.pbs</dt><dd><div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>These files don’t exist somewhere publicly available yet</p>
</div>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt>schism.sh file</dt><dd><div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>These files don’t exist somewhere publicly available yet</p>
</div>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Download <a class="reference external" href="https://github.com/CADWRDeltaModeling/dms_datastore/blob/master/dms_datastore/example/noaa_stations.txt">noaa_stations.txt</a></dt><dd></dd>
</dl>
</li>
</ul>
</li>
<li><p>Edit input files</p>
<ul>
<li><dl class="simple">
<dt>If modifying the bathymetric data create a copy of ‘dem_4.2_cc.yaml’ and rename it</dt><dd><ul class="simple">
<li><p>correctly locate the Dutch Slough DEM</p></li>
<li><p>Suppy additional DEM data</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt>main_bay_delta.yaml</dt><dd><ul>
<li><p>change mesh_inputfile: parameter to match the .2dm file you copied into the project folder</p></li>
<li><dl class="simple">
<dt>check that the vgrid: section contains a vgrid_version: variable set to the SCHISM version being used (5.8 or 5.10)</dt><dd><ul class="simple">
<li><p>ex: vgrid_version: ‘5.10’ # Note that quotation marks are necessary</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>If you’ve modified the bathymetric data, then update the dem yaml file to that .yaml file</p></li>
<li><p>Add these lines above the sav_*.gr3 specifications:</p>
<blockquote>
<div><div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sav_cd.gr3:
   default: 1.13
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>sav_density.yaml</dt><dd><ul class="simple">
<li><p>change “W:/sav” to “//nasbdo/Modeling_Data/sav” for all cases where “W:/sav” is found</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt>multi_clip.py</dt><dd><ul>
<li><p>Set the following variables according to your simulation start date (this example uses May 1, 2009)</p>
<blockquote>
<div><div class="highlight-text notranslate"><div class="highlight"><pre><span></span>start=dtm.datetime(2009,5,1)
bds_home = &quot;&lt;BAYDELTASCHISM REPOSITORY LOCATION&gt;&quot;
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>launch.tropic.pbs &amp; launch.clinic.pbs</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>#PBS -N &lt;SIMULATION NAME&gt;</dt><dd><ul>
<li><p>ex: #PBS -N v112_demo</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>#PBS -M &lt;USER EMAIL&gt;, &lt;USER&gt;&#64;localhost</dt><dd><ul>
<li><p>ex: #PBS -M <a class="reference external" href="mailto:jane&#46;doe&#37;&#52;&#48;water&#46;ca&#46;gov">jane<span>&#46;</span>doe<span>&#64;</span>water<span>&#46;</span>ca<span>&#46;</span>gov</a>,janedoe&#64;localhost</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>schism.sh</dt><dd><ul class="simple">
<li><p>Set the last line to be the location of your compiled pschism build followed by the number 10</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>param.nml.tropic &amp; param.nml.clinic</dt><dd><ul class="simple">
<li><p>Set start_year, start_month, start_day, start_hour, and utc_start according to the simulation start date</p></li>
<li><p>Edit byear, eyear, bmonth, emonth, bday, eday to have the full date range of the simulation</p></li>
<li><p>Edit rnday for runtime</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>make_links_full.py</dt><dd><ul class="simple">
<li><p>check src_dir and src_dir_narr</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</li>
<li><p>Run files:</p>
<ul class="simple">
<li><dl class="simple">
<dt>multi_clip.py</dt><dd><ul>
<li><p>Creates a list of .th files necessary for the run to execute found in simulation directory</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>In a conda environment with schimpy installed, go to simulation directory and run:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">prepare_schism main_bay_delta.yaml</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Create station inputs using:</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">station --station_db station_dbase.csv --subloc_db station_subloc.csv --request all</span>
</pre></div>
</div>
</li>
<li><p>Create Hotstart and Nudging datasets</p>
<ul class="simple">
<li><p>If you’re only running a 2D/Barotropic simulation then you don’t need to create these files!</p></li>
<li><dl class="simple">
<dt>Create a sub-folder (./baydeltainputs/hotstart) and copy files:</dt><dd><ul>
<li><p>hotstart_nudging_data.py</p></li>
<li><p>hotstart_lat.py</p></li>
<li><p>clean_nudge.py</p></li>
<li><p>clean_polaris.py</p></li>
<li><p>hotstart.yaml</p></li>
<li><p>nudging.yaml</p></li>
<li><p>nudge_roms/nudge_obs_roms.yaml</p></li>
<li><p>nudge_roms/roms_nudge.py</p></li>
<li><p>shapefile/RegionsPolygon.*</p></li>
<li><p>USGS_polaris_station_locations_xy.csv</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>These files don’t exist somewhere publicly available yet</p>
</div>
<ul>
<li><dl class="simple">
<dt>Download Polaris *.csv data from the USGS data query <a class="reference external" href="https://sfbay.wr.usgs.gov/water-quality-database/">https://sfbay.wr.usgs.gov/water-quality-database/</a></dt><dd><ul class="simple">
<li><p>Go to year, show all entries, and export data</p></li>
<li><p>Save as: hotstartUSGS_2009_saltemp.csv (where 2009 is whichever year you’ve downloaded)</p></li>
<li><dl class="simple">
<dt>Run <em>clean_polaris.py</em> or some other QA/QC on the USGS_2009_saltemp.csv file</dt><dd><ul>
<li><p>This creates a copy of the file with _edit.csv as the extension</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><p>Edit files:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>hotstart_nudging_data.py</dt><dd><ul>
<li><dl class="simple">
<dt>Change nudging time to desired model run length</dt><dd><ul>
<li><p>ex: nudgelen=days(60)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Set start time</dt><dd><ul>
<li><p>ex: t0=pd.Timestamp(2009,5,1)</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>hotstart.yaml</dt><dd><ul>
<li><p>Point to correct hgrid and vgrid _input files (../hgrid.gr3 &amp; ../vgrid.in.3d generated from prepare_schism)</p></li>
<li><p>For all data using “extrude_casts:” method, replace with ./USGS_2009_saltemp_edit.csv</p></li>
<li><p>For all data using “obs_points:” method, replace with “./hotstart_data_{temperature/salinity}.csv” and variable: {temperature/salinity} depending on whether looking to set temperature or salinity. These files will be generated with  hotstart_nudging_data.py</p></li>
<li><p>Set vgrid_version=’5.10’ # Note that the quotation marks are important</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>nudging.yaml</dt><dd><ul>
<li><dl class="simple">
<dt>Change run days to whatever number of days you want the internal points to be nudged towards observation data</dt><dd><ul>
<li><p>ex: rnday: 7</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Set vgrid_version=’5.10’</p></li>
<li><p>Change temperature/salinity data: ./nudging_data_{temperature/salinity}_edit.csv based on which variable you’re setting</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>nudge_roms/nudge_obs_roms.yaml</dt><dd><ul>
<li><p>start_date: 2009-05-01 (or whatever your start date is)</p></li>
<li><p>rnday: 60</p></li>
<li><p>Point to correct hgrid/vgrid files (../hgrid.gr3 &amp; ../vgrid.in.3d)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>hotstart_lat.py</dt><dd><ul>
<li><p>Set vgrid_version=’5.10’</p></li>
<li><p>Set hgrid and vgrid to same filenames as hotstart.yaml (../hgrid.gr3 &amp; ../vgrid.in.3d)</p></li>
<li><p>Set ini_date to correct start date</p></li>
<li><p>Set hotstart_fn to appropriate filename (ex: hotstart.20090501.nc or whatever your start date is)</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
<li><p>Run files:</p>
<blockquote>
<div><ul class="simple">
<li><p>You’ll want to run these files in a conda environment that has dms_datastore installed (There’s an existing environment.yaml file which will set this up for you)</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The environment.yaml file does not exist somewhere publicly available yet</p>
</div>
<ul class="simple">
<li><dl class="simple">
<dt>hotstart_nudging_data.py</dt><dd><ul>
<li><p>Takes quite a long time, if the time period hasn’t changed then this step does not need to be repeated</p></li>
<li><dl class="simple">
<dt>Need to QA/QC hotstart and nudging csv data</dt><dd><ul>
<li><p>Run clean_nudge.py to create nudging_data_{temperature/salinity}_edit.csv</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>hotstart.py</dt><dd><ul>
<li><dl class="simple">
<dt>Creates:</dt><dd><ul>
<li><dl class="simple">
<dt>salinity_nudge.gr3</dt><dd><ul>
<li><p>temperature_nudge.gr3</p></li>
<li><p>hotstart.20090501.nc</p></li>
<li><p>SAL_nu_obsroms.nc</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>nudge_roms/roms_nudge.py</dt><dd><ul>
<li><p>Takes a very long time. If the time period <em>or</em> grid hasn’t changed then this step does not need to be repeated</p></li>
<li><p>Rename SAL_nu_obsroms.nc and TEM_nu_obsroms.nc to be SAL_nu_roms.nc and TEM_nu_roms.nc</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
<li><dl class="simple">
<dt>Copy output files out to the main simulation folder (./baydeltainputs)</dt><dd><ul class="simple">
<li><p>hotstart/TEM_nu_obsroms.nc</p></li>
<li><p>hotstart/SAL_nu_obsroms.nc</p></li>
<li><p>hotstart/temperature_nudge.gr3</p></li>
<li><p>hotstart/salinity_nudge.gr3</p></li>
<li><p>hotstart/hotstart.20090501.nc</p></li>
<li><p>hotstart/hgrid.nc</p></li>
<li><p>hotstart/nudge_roms/TEM_nu_roms.nc</p></li>
<li><p>hotstart/nudge_roms/SAL_nu_roms.nc</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</li>
</ol>
</div>
<div class="section" id="linux">
<h2>Linux<a class="headerlink" href="#linux" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Create the folder where you will be running the model (ex: /scratch/dms/{username}/schism/bdsch_scratch_demo)</p>
<ul class="simple">
<li><p>from your Windows machine, copy “./baydeltainputs” contents into your Linux model folder (bdsch_scratch_demo)</p></li>
</ul>
</li>
</ol>
<div class="section" id="barotropic">
<h3>Barotropic<a class="headerlink" href="#barotropic" title="Permalink to this heading">¶</a></h3>
<ol class="arabic">
<li><p>Make symbolic links for sflux files</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>mkdir sflux</dt><dd><ul>
<li><p>cd sflux</p></li>
<li><p>python ../make_links_full.py</p></li>
<li><p>cd ..</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
</ol>
<p>Then you’ll need a sflux_inputs.txt file within the sflux folder</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The sflux_inputs.txt file does not exist somewhere publicly available yet</p>
</div>
<ol class="arabic">
<li><p>Create elev2d.th.nc file. Run in Linux conda environment with dms_datastore and schimpy installed:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">download_noaa --syear 2009 --eyear 2009 --param water_level noaa_stations.txt</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Adjust start and end year based on simulation period</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">gen_elev2d --outfile elev2D.th.nc --hgrid=hgrid.gr3 --stime=2009-5-1 --etime=2009-7-1 --slr 0.0 noaa_download/noaa_pryc1_9415020_water_level_2009_2010.csv noaa_download/noaa_mtyc1_9413450_water_level_2009_2010.csv</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Again, be mindful of the years in the filenames as well as the stime and etime inputs</p></li>
</ul>
</li>
<li><p>Make symbolic links for the Barotropic run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ln -sf bctides.in.2d bctides.in</span>
<span class="go">ln -sf vgrid.in.2d vgrid.in</span>
<span class="go">ln -sf msource_v20220825.th msource.th</span>
<span class="go">ln -sf vsource_20220825_nows_leach1.th vsource.th</span>
<span class="go">ln -sf vsink_20220825_nows_leach1_sscd1.5.th vsink.th</span>
<span class="go">ln -sf TEM_1.th temp.th</span>
<span class="go">ln -sf SAL_1.th salt.th</span>
<span class="go">ln -sf param.nml.tropic param.nml</span>
<span class="go">ln -sf launch.tropic.pbs launch.pbs</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Make the outputs directory</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir outputs</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Run barotropic model</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">qsub launch.pbs</span>
</pre></div>
</div>
</li>
</ol>
<p>This will run the Barotropic model without nudging or hotstart data and then you will use the Barotropic results to generate a flow boundary at the ocean in order to stabilize perturbations in the model.</p>
</div>
<div class="section" id="baroclinic">
<h3>Baroclinic<a class="headerlink" href="#baroclinic" title="Permalink to this heading">¶</a></h3>
<p>This needs to follow the completion of a Barotropic simulation in order to create the ocean boundary flows. At this stage the hotstart and nudging files created in the Windows portion are used on the temperature and salinity fields.</p>
<blockquote>
<div><ol class="arabic">
<li><p>Rename the <em>outputs</em> folder to <em>outputs.tropic</em> and create a new empty <em>outputs</em> folder</p></li>
<li><p>Create uv3d.th.nc</p>
<ul>
<li><dl>
<dt>In <em>outputs.tropic</em></dt><dd><ul class="simple">
<li><p>Copy <em>interpolate_variables.in</em> to <em>outputs.tropic</em> folder</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The interpolate_variables.in file does not exist somewhere publicly available yet</p>
</div>
<ul class="simple">
<li><p>Create symbolic links</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ln -sf ../hgrid.gr3 bg.gr3</span>
<span class="go">ln -sf ../hgrid.gr3.fg.gr3</span>
<span class="go">ln -sf ../vgrid.in.2d vgrid.bg</span>
<span class="go">ln -sf ../vgrid.in.3d vgrid.fg</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Run script to create <em>uv3d.th.nc</em> in a conda environment with schimpy</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">interpolate_variables8</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Copy the <em>uv3d.th.nc</em> file to the main folder</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</li>
<li><p>Create symbolic links back in the main simulation folder</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ln -sf hotstart.20090501.nc hotstart.nc</span>
<span class="go">ln -sf SAL_nu_obsroms.nc SAL_nu.nc</span>
<span class="go">ln -sf TEM_nu_obsroms.nc TEM_nu.nc</span>
<span class="go">ln -sf salinity_nudge.gr3 SAL_nudge.gr3</span>
<span class="go">ln -sf temperature_nudge.gr3 TEM_nudge.gr3</span>
<span class="go">ln -sf param.nml.clinic param.nml</span>
<span class="go">ln -sf bctides.in.3d bctides.in</span>
<span class="go">ln -sf vgrid.in.3d vgrid.in</span>
<span class="go">ln -sf launch.clinic.pbs launch.pbs</span>
</pre></div>
</div>
</li>
<li><p>Run model for period which the internal salinity/temperature nudging runs (in this example, the model will stop after 7 days)</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">qsub launch.pbs</span>
</pre></div>
</div>
</li>
<li><p>After model stops, need to restart from hotstart outputs from the previous run</p>
<ul class="simple">
<li><p>Run combine_hotstart7 on last timestep output to hotstart within the outputs</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/home/&lt;USERNAME&gt;/.../src/Utility/Combining_Scripts/combine_hotstart7.exe --iteration 4800</span>
</pre></div>
</div>
<p>Note that the iteration variable is based on variables in param.nml <em>nhot_write</em> which is set to 4800 in this example. 4800 x <em>dt</em> = 4800 x 90s = 5 days</p>
<ul class="simple">
<li><p>Change links to hotstart and nudging data</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ln -sf outputs/hotstart_it\=4800.nc hotstart.nc</span>
<span class="go">ln -sf SAL_nu_roms.nc SAL_nu.nc</span>
<span class="go">ln -sf TEM_nu_roms.nc TEM_nu.nc</span>
</pre></div>
</div>
<ul class="simple">
<li><dl class="simple">
<dt>Edit param.nml.clinic</dt><dd><ul>
<li><p>Change ihot to <em>ihot = 2</em> to start outputs from the timestep in the new hotstart file</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Run the model</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">qsub launch.pbs</span>
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="preprocess.html" title="Study Templates and Preprocessing"
             >next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="Overview of Basic Bay-Delta SCHISM Run"
             >previous</a> |</li>
        <li><a href="https://water.ca.gov/Library/Modeling-and-Analysis/Bay-Delta-Region-models-and-tools"> Delta Modeling Section</a>|&nbsp;</li>
        <li><a href="https://github.com/CADWRDeltaModeling">GitHub</a>|&nbsp;</li>
        <li><a href="../search.html">Search</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="../learning.html" >Learning Resources for Bay-Delta SCHISM</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../topical_guide.html" >Bay-Delta SCHISM Topical Guide</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Vignette: Hindcast Bay Delta SCHISM at Delta Modeling Section with Preprocessor</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014,2020 California Department of Water Resources.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.2.
    </div>
  </body>
</html>