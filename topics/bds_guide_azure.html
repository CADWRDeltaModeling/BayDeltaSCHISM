<!-- Empty override file take the place of env/lib/python3.8/site-packages/sphinx_rtd_theme/breadcrumbs.html, which generates the top nav breadcrumbs. -->

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Step-by-step: Bay-Delta SCHISM on Azure &mdash; Bay-Delta SCHISM</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/style.css?v=8686dbcc" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=ca842793"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Common Problems and Diagnosis" href="problems.html" />
    <link rel="prev" title="Running on Azure Batch" href="azure.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/logo6.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Bay-Delta SCHISM Project</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getmodel.html">Installation And Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getmodel.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getmodel.html#schism-software-code-binaries">SCHISM Software Code/Binaries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getmodel.html#downloading">Downloading</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getmodel.html#compile-settings">Compile Settings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getmodel.html#bay-delta-schism-python-package">Bay-Delta SCHISM Python Package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getmodel.html#id1">Downloading</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getmodel.html#contents">Contents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getmodel.html#bathymetry">Bathymetry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getmodel.html#complete-sample-inputs">Complete Sample Inputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getmodel.html#other-required-python-packages">Other Required Python Packages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getmodel.html#configuration-system">Configuration System</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getmodel.html#id3">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getmodel.html#configuration-file-locations-and-priorities">Configuration File Locations and Priorities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getmodel.html#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getmodel.html#example-configuration-file">Example Configuration File</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getmodel.html#visit-schism-plug-in">VisIt SCHISM Plug-in</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getmodel.html#links-to-tools">Links to tools</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../user_guide.html">Bay-Delta SCHISM User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#setup">Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="processed_run.html">Running a Preprepared Setup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#model-essentials">Model Essentials</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#overview">Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="overview.html">Overview of a Bay-Delta SCHISM Run</a><ul>
<li class="toctree-l5"><a class="reference internal" href="overview.html#grid-and-spatial-data">Grid and Spatial Data</a><ul>
<li class="toctree-l6"><a class="reference internal" href="overview.html#templates">Templates</a></li>
<li class="toctree-l6"><a class="reference internal" href="overview.html#preprocessor">Preprocessor</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="overview.html#time-dependent-data">Time-dependent data</a></li>
<li class="toctree-l5"><a class="reference internal" href="overview.html#files-that-change-with-both-mesh-and-dates">Files that Change with Both Mesh and Dates</a></li>
<li class="toctree-l5"><a class="reference internal" href="overview.html#driver-files-param-tropic-nml-param-clinic-nml">Driver Files (param.tropic.nml, param.clinic.nml)</a></li>
<li class="toctree-l5"><a class="reference internal" href="overview.html#other-nomenclature-and-concepts">Other Nomenclature and Concepts</a></li>
<li class="toctree-l5"><a class="reference internal" href="overview.html#organizing-the-launch-directory">Organizing the Launch Directory</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="vignette.html">Vignette: Hindcast Bay Delta SCHISM at Delta Modeling Section with Preprocessor</a><ul>
<li class="toctree-l5"><a class="reference internal" href="vignette.html#windows">Windows</a></li>
<li class="toctree-l5"><a class="reference internal" href="vignette.html#linux">Linux</a><ul>
<li class="toctree-l6"><a class="reference internal" href="vignette.html#barotropic">Barotropic</a></li>
<li class="toctree-l6"><a class="reference internal" href="vignette.html#baroclinic">Baroclinic</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="files_and_directories.html">Required Files, Directory Structure and Recommended Study Practices</a><ul>
<li class="toctree-l5"><a class="reference internal" href="files_and_directories.html#required-files-and-structure">Required files and structure</a><ul>
<li class="toctree-l6"><a class="reference internal" href="files_and_directories.html#schism-launch-directory-structure">SCHISM launch directory structure</a></li>
<li class="toctree-l6"><a class="reference internal" href="files_and_directories.html#launch-directory">Launch directory</a></li>
<li class="toctree-l6"><a class="reference internal" href="files_and_directories.html#output-directory">Output directory</a></li>
<li class="toctree-l6"><a class="reference internal" href="files_and_directories.html#atmospheric-sflux-directory">Atmospheric (sflux) directory</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="files_and_directories.html#study-layout">Study layout</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="preprocess.html">Grid, Spatial Data and Preprocessor</a><ul>
<li class="toctree-l5"><a class="reference internal" href="preprocess.html#do-i-need-it-copy-existing-run-vs-preprocess-from-template">Do I need it? Copy existing run vs preprocess from template?</a></li>
<li class="toctree-l5"><a class="reference internal" href="preprocess.html#running-the-preprocessor">Running the preprocessor</a><ul>
<li class="toctree-l6"><a class="reference internal" href="preprocess.html#applying-the-template">Applying the template</a></li>
<li class="toctree-l6"><a class="reference internal" href="preprocess.html#partial-preprocessing-for-modification">Partial preprocessing for modification</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="preprocess.html#configuring-the-input-yaml">Configuring the input (yaml)</a></li>
<li class="toctree-l5"><a class="reference internal" href="preprocess.html#where-to-required-files-and-directory-structure">Where to? Required files and directory structure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#boundaries-input-files">Boundaries &amp; Input Files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="ocean.html">Prepare Ocean Boundary (elev2D.th.nc)</a></li>
<li class="toctree-l4"><a class="reference internal" href="flow_boundary.html">Inflow/Outflow Boundaries</a><ul>
<li class="toctree-l5"><a class="reference internal" href="flow_boundary.html#where-are-the-data">Where are the data?</a></li>
<li class="toctree-l5"><a class="reference internal" href="flow_boundary.html#clipping-to-run-dates-and-conversion-to-elapsed-time">Clipping to run dates and conversion to elapsed time</a></li>
<li class="toctree-l5"><a class="reference internal" href="flow_boundary.html#what-if-i-have-to-add-or-move-a-boundary">What if I have to add or move a boundary?</a></li>
<li class="toctree-l5"><a class="reference internal" href="flow_boundary.html#adding-data-from-other-sources-e-g-forecasts-other-models">Adding Data From Other Sources (e.g. Forecasts, other models)</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="atmospheric.html">Atmospheric setup</a><ul>
<li class="toctree-l5"><a class="reference internal" href="atmospheric.html#basic-introduction-and-requirements">Basic introduction and requirements</a></li>
<li class="toctree-l5"><a class="reference internal" href="atmospheric.html#where-are-the-data">Where are the data?</a></li>
<li class="toctree-l5"><a class="reference internal" href="atmospheric.html#pointing-to-the-data-with-make-links-full-py">Pointing to the data with make_links_full.py</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="barotropic.html">Ocean Boundary Stabilization: Barotropic Warmup</a><ul>
<li class="toctree-l5"><a class="reference internal" href="barotropic.html#introduction">Introduction</a></li>
<li class="toctree-l5"><a class="reference internal" href="barotropic.html#workflow">Workflow</a><ul>
<li class="toctree-l6"><a class="reference internal" href="barotropic.html#bctides-in">bctides.in</a></li>
<li class="toctree-l6"><a class="reference internal" href="barotropic.html#param-nml">param.nml</a></li>
<li class="toctree-l6"><a class="reference internal" href="barotropic.html#vgrid-in">vgrid.in</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="param.html">Key Run Parameters and Gotchas</a><ul>
<li class="toctree-l5"><a class="reference internal" href="param.html#runtime-settings">Runtime settings</a></li>
<li class="toctree-l5"><a class="reference internal" href="param.html#hotstart-settings">Hotstart settings</a></li>
<li class="toctree-l5"><a class="reference internal" href="param.html#nudging-settings">Nudging settings</a></li>
<li class="toctree-l5"><a class="reference internal" href="param.html#output-requests">Output requests</a></li>
<li class="toctree-l5"><a class="reference internal" href="param.html#settings-that-have-historically-gone-awry">Settings that have historically gone awry</a></li>
<li class="toctree-l5"><a class="reference internal" href="param.html#what-happens-when-schism-versions-get-advanced">What happens when SCHISM versions get advanced?</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="hotstart.html">Run Initialization and Restart (Hotstart)</a><ul>
<li class="toctree-l5"><a class="reference internal" href="hotstart.html#when-do-you-need-an-initial-condition-or-hotstart">When do you need an initial condition or hotstart?</a></li>
<li class="toctree-l5"><a class="reference internal" href="hotstart.html#what-is-the-difference-between-a-cold-and-hot-start">What is the difference between a cold and hot start?</a></li>
<li class="toctree-l5"><a class="reference internal" href="hotstart.html#combining-hotstarts">Combining hotstarts</a></li>
<li class="toctree-l5"><a class="reference internal" href="hotstart.html#choosing-a-good-start-time">Choosing a good start time</a></li>
<li class="toctree-l5"><a class="reference internal" href="hotstart.html#creating-a-hotstart-for-hydro-salt-temp-with-schism-hotstart">Creating a Hotstart for Hydro/Salt/Temp with schism_hotstart</a><ul>
<li class="toctree-l6"><a class="reference internal" href="hotstart.html#acquiring-the-data">Acquiring the data</a></li>
<li class="toctree-l6"><a class="reference internal" href="hotstart.html#configuring-the-hotstart-request-yaml">Configuring the Hotstart request (yaml)</a></li>
<li class="toctree-l6"><a class="reference internal" href="hotstart.html#running-the-hotstart-generator">Running the hotstart generator</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="nudging.html">Nudging Files</a><ul>
<li class="toctree-l5"><a class="reference internal" href="nudging.html#introduction-what-is-nudging">Introduction: What is nudging?</a></li>
<li class="toctree-l5"><a class="reference internal" href="nudging.html#do-i-need-nudging">Do I need nudging?</a></li>
<li class="toctree-l5"><a class="reference internal" href="nudging.html#generating-nudging-files">Generating nudging files</a><ul>
<li class="toctree-l6"><a class="reference internal" href="nudging.html#schimpy.nudging.Nudging"><code class="docutils literal notranslate"><span class="pre">Nudging</span></code></a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="nudging.html#preparing-for-nudging-with-observed-data">Preparing for nudging with observed data</a></li>
<li class="toctree-l5"><a class="reference internal" href="nudging.html#nudging-example">Nudging Example</a></li>
<li class="toctree-l5"><a class="reference internal" href="nudging.html#sequencing-your-run">Sequencing your run</a></li>
<li class="toctree-l5"><a class="reference internal" href="nudging.html#references">References</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="vegetation.html">Vegetation</a><ul>
<li class="toctree-l5"><a class="reference internal" href="vegetation.html#aquatic-vegetation-in-schism">Aquatic Vegetation in SCHISM</a></li>
<li class="toctree-l5"><a class="reference internal" href="vegetation.html#approximations-and-preprocessor">Approximations and preprocessor</a></li>
<li class="toctree-l5"><a class="reference internal" href="vegetation.html#effective-stem-density">Effective Stem Density</a></li>
<li class="toctree-l5"><a class="reference internal" href="vegetation.html#height">Height</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#inspection-of-model-setup">Inspection of Model Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="checklists.html">Checklists</a><ul>
<li class="toctree-l5"><a class="reference internal" href="checklists.html#running-a-processed-setup">Running a Processed Setup</a></li>
<li class="toctree-l5"><a class="reference internal" href="checklists.html#simple-hindcast-runs">Simple Hindcast Runs</a><ul>
<li class="toctree-l6"><a class="reference internal" href="checklists.html#cbox-choose-run-dates">☐ Choose run dates</a></li>
<li class="toctree-l6"><a class="reference internal" href="checklists.html#cbox-apply-template-to-existing-mesh">☐ Apply template to existing mesh</a></li>
<li class="toctree-l6"><a class="reference internal" href="checklists.html#cbox-collect-time-series-inputs">☐ Collect time series inputs</a></li>
<li class="toctree-l6"><a class="reference internal" href="checklists.html#cbox-hotstart-can-be-concurrent-with-barotropic">☐ Hotstart (can be concurrent with barotropic)</a></li>
<li class="toctree-l6"><a class="reference internal" href="checklists.html#cbox-nudging-can-be-concurrent-with-barotropic">☐ Nudging (can be concurrent with barotropic)</a></li>
<li class="toctree-l6"><a class="reference internal" href="checklists.html#cbox-barotropic-warmup">☐ Barotropic warmup</a></li>
<li class="toctree-l6"><a class="reference internal" href="checklists.html#cbox-baroclinic-simulation">☐ Baroclinic simulation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="run_tests.html">Test Suite for Prechecking Runs</a><ul>
<li class="toctree-l5"><a class="reference internal" href="run_tests.html#using-the-tests">Using the Tests</a></li>
<li class="toctree-l5"><a class="reference internal" href="run_tests.html#writing-run-tests">Writing Run Tests</a><ul>
<li class="toctree-l6"><a class="reference internal" href="run_tests.html#basics-of-testing">Basics of testing</a></li>
<li class="toctree-l6"><a class="reference internal" href="run_tests.html#test-fixtures">Test Fixtures</a></li>
<li class="toctree-l6"><a class="reference internal" href="run_tests.html#markers">Markers</a></li>
<li class="toctree-l6"><a class="reference internal" href="run_tests.html#what-to-test">What to test</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#output-files">Output Files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="output.html">Output</a><ul>
<li class="toctree-l5"><a class="reference internal" href="output.html#flavors-of-output">Flavors of output</a></li>
<li class="toctree-l5"><a class="reference internal" href="output.html#what-you-should-plan-in-advance">What you should plan in advance</a></li>
<li class="toctree-l5"><a class="reference internal" href="output.html#request-station-output">Request station output</a><ul>
<li class="toctree-l6"><a class="reference internal" href="output.html#station-in">station.in</a></li>
<li class="toctree-l6"><a class="reference internal" href="output.html#flow-xsects-yaml-and-fluxflags-out">flow_xsects.yaml and fluxflags.out</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="output.html#request-dense-output">Request dense output:</a></li>
<li class="toctree-l5"><a class="reference internal" href="output.html#working-with-staout-files">Working with staout_ files</a></li>
<li class="toctree-l5"><a class="reference internal" href="output.html#working-with-flux-out-files">Working with flux.out files</a></li>
<li class="toctree-l5"><a class="reference internal" href="output.html#visualizing-dense-nc-output-in-visit">Visualizing dense (.nc) output in VisIt</a></li>
<li class="toctree-l5"><a class="reference internal" href="output.html#schism-s-extraction-utilities">SCHISM’s extraction utilities</a></li>
<li class="toctree-l5"><a class="reference internal" href="output.html#quick-validation-plots">Quick validation plots</a></li>
<li class="toctree-l5"><a class="reference internal" href="output.html#where-do-we-keep-specialized-postprocessing-materials">Where do we keep specialized postprocessing materials?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../user_guide.html#computing-resources">Computing Resources</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="hpc.html">Intro to Clusters and High Performance Computing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="hpc.html#anatomy-of-a-cluster">Anatomy of a Cluster</a></li>
<li class="toctree-l4"><a class="reference internal" href="hpc.html#figure-cluster-components">Figure: Cluster Components</a></li>
<li class="toctree-l4"><a class="reference internal" href="hpc.html#compilation">Compilation</a></li>
<li class="toctree-l4"><a class="reference internal" href="hpc.html#job-submission">Job Submission</a></li>
<li class="toctree-l4"><a class="reference internal" href="hpc.html#compute-nodes-and-message-passing">Compute Nodes and Message Passing</a></li>
<li class="toctree-l4"><a class="reference internal" href="hpc.html#input-output-and-scribes">Input/Output and Scribes</a></li>
<li class="toctree-l4"><a class="reference internal" href="hpc.html#example-slurm-launch-file">Example Slurm Launch File</a></li>
<li class="toctree-l4"><a class="reference internal" href="hpc.html#example-shell-script-to-run-schism">Example Shell Script to Run SCHISM</a></li>
<li class="toctree-l4"><a class="reference internal" href="hpc.html#intro-to-batch-cloud-cluster">Intro to Batch Cloud Cluster</a></li>
<li class="toctree-l4"><a class="reference internal" href="hpc.html#figure-azure-batch-cluster-components">Figure: Azure Batch Cluster Components</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="azure.html">Running on Azure Batch</a><ul>
<li class="toctree-l4"><a class="reference internal" href="azure.html#setup-azure">Setup Azure</a><ul>
<li class="toctree-l5"><a class="reference internal" href="azure.html#download-azure-utilities">Download Azure Utilities</a></li>
<li class="toctree-l5"><a class="reference internal" href="azure.html#login">Login</a></li>
<li class="toctree-l5"><a class="reference internal" href="azure.html#create-a-resource-group">Create a Resource Group</a></li>
<li class="toctree-l5"><a class="reference internal" href="azure.html#download-azure-dms-batch">Download azure_dms_batch</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="azure.html#references">References</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Step-by-step: Bay-Delta SCHISM on Azure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#initial-setup">Initial Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#upload-applications">Upload Applications</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#schism">SCHISM</a></li>
<li class="toctree-l5"><a class="reference internal" href="#python-packages">Python Packages</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#uploading-model-input-files">Uploading Model Input Files</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#azcopy-commands">azcopy commands</a></li>
<li class="toctree-l5"><a class="reference internal" href="#azcopy-options">azcopy options</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#running-model-simulation">Running Model Simulation</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#simple-run-config">Simple Run Config</a></li>
<li class="toctree-l5"><a class="reference internal" href="#spot-pricing-config">Spot Pricing Config</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#advanced-tasks-and-concepts">Advanced Tasks and Concepts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="problems.html">Common Problems and Diagnosis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="problems.html#where-does-schism-write-error-messages">Where does SCHISM write error messages?</a></li>
<li class="toctree-l4"><a class="reference internal" href="problems.html#my-run-says-segfault">My run says “segfault”</a></li>
<li class="toctree-l4"><a class="reference internal" href="problems.html#the-runs-seems-very-slow-compared-to-normal">The runs seems very slow compared to normal</a></li>
<li class="toctree-l4"><a class="reference internal" href="problems.html#dry-boundary">Dry boundary</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="age.html">Simulating water age</a><ul>
<li class="toctree-l4"><a class="reference internal" href="age.html#compile-with-age">Compile with age</a></li>
<li class="toctree-l4"><a class="reference internal" href="age.html#parameters-in-param-nml">Parameters in param.nml</a></li>
<li class="toctree-l4"><a class="reference internal" href="age.html#additional-ic-files">Additional *.ic files</a></li>
<li class="toctree-l4"><a class="reference internal" href="age.html#hotstart-considerations">Hotstart considerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="age.html#typical-output-processing">Typical output processing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="sea_level_rise.html">Sea Level Rise</a></li>
<li class="toctree-l3"><a class="reference internal" href="sources.html">Sources, Sinks, Delta Channel Depletions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="sources.html#identifying-source-locations-and-names-in-preprocessor">Identifying source locations and names in preprocessor</a></li>
<li class="toctree-l4"><a class="reference internal" href="sources.html#delta-and-suisun-channel-depletions">Delta and Suisun channel depletions</a></li>
<li class="toctree-l4"><a class="reference internal" href="sources.html#making-sure-you-includ-the-th-files-for-sources-sinks">Making sure you includ the th files for sources/sinks</a></li>
<li class="toctree-l4"><a class="reference internal" href="sources.html#tracer-concentrations">Tracer concentrations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="structures.html">Hydraulic Structures</a><ul>
<li class="toctree-l4"><a class="reference internal" href="structures.html#where-is-the-documentation">Where is the documentation?</a></li>
<li class="toctree-l4"><a class="reference internal" href="structures.html#setting-up-the-mesh-to-make-structures-easy">Setting up the mesh to make structures easy</a></li>
<li class="toctree-l4"><a class="reference internal" href="structures.html#preventing-dry-boundary-messages">Preventing dry boundary messages</a></li>
<li class="toctree-l4"><a class="reference internal" href="structures.html#important-bay-delta-examples">Important Bay-Delta examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mesh.html">Gridding the Horizontal Mesh</a><ul>
<li class="toctree-l4"><a class="reference internal" href="mesh.html#meshing">Meshing</a><ul>
<li class="toctree-l5"><a class="reference internal" href="mesh.html#meshing-considerations-for-schism">Meshing considerations for SCHISM</a><ul>
<li class="toctree-l6"><a class="reference internal" href="mesh.html#video-joseph-zhang-schism-summit">Video (Joseph Zhang, SCHISM summit)</a></li>
<li class="toctree-l6"><a class="reference internal" href="mesh.html#recap-checklist">Recap/checklist</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="mesh.html#getting-to-know-sms">Getting to know SMS</a><ul>
<li class="toctree-l6"><a class="reference internal" href="mesh.html#sample-data">Sample Data</a></li>
<li class="toctree-l6"><a class="reference internal" href="mesh.html#id1">Recap checklist</a></li>
<li class="toctree-l6"><a class="reference internal" href="mesh.html#presentation-clip-dems-and-efficient-use-of-dems">Presentation: clip_dems and efficient use of DEMS</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="mesh.html#building-the-bay-delta-mesh-the-standard-way">Building the Bay-Delta mesh the standard way</a></li>
<li class="toctree-l5"><a class="reference internal" href="mesh.html#presentation-meshing-consideration-for-marshes-and-restoration">Presentation: Meshing consideration for marshes and restoration</a></li>
<li class="toctree-l5"><a class="reference internal" href="mesh.html#merging-stitching-sms-mesh-maps-new-work-flooded-islands-etc">Merging/Stitching SMS mesh/maps (new work, flooded islands, etc)</a><ul>
<li class="toctree-l6"><a class="reference internal" href="mesh.html#video">Video</a></li>
<li class="toctree-l6"><a class="reference internal" href="mesh.html#id2">Recap/checklist</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="mesh.html#vertical-mesh-setup">Vertical mesh setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="mesh.html#checklist-for-after-you-change-the-mesh">Checklist for after you change the mesh</a></li>
<li class="toctree-l4"><a class="reference internal" href="mesh.html#performance-tuning">Performance Tuning</a><ul>
<li class="toctree-l5"><a class="reference internal" href="mesh.html#the-analyze-dt-utility">The analyze_dt Utility</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="utilities.html">Utilities and Scripts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="utilities.html#gis-conversion">GIS Conversion</a><ul>
<li class="toctree-l5"><a class="reference internal" href="utilities.html#mesh-to-shapefile">Mesh to shapefile</a></li>
<li class="toctree-l5"><a class="reference internal" href="utilities.html#polygons-to-from-shapefile">Polygons to/from shapefile</a></li>
<li class="toctree-l5"><a class="reference internal" href="utilities.html#polylines-to-from-shapefile">Polylines to/from shapefile</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="utilities.html#hotstart-inventory-convert-iteration-numbers-to-dates">Hotstart Inventory: Convert iteration numbers to dates</a></li>
<li class="toctree-l4"><a class="reference internal" href="utilities.html#model-time-and-multi-clip">model_time and multi_clip</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../learning.html">Learning Resources for Bay-Delta SCHISM</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../learning.html#general-resources-and-tools">General Resources and Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../bay_delta_tutorials.html">Bay-Delta SCHSIM Tutorials</a></li>
<li class="toctree-l3"><a class="reference internal" href="../linux.html">Linux Hints for SCHISM</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../linux.html#using-linux-from-windows">Using Linux from Windows</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../linux.html#basic-connection">Basic connection</a></li>
<li class="toctree-l5"><a class="reference internal" href="../linux.html#copying-files">Copying files</a></li>
<li class="toctree-l5"><a class="reference internal" href="../linux.html#xwindow-emulation">XWindow Emulation</a></li>
<li class="toctree-l5"><a class="reference internal" href="../linux.html#all-in-one-mobaxterm">All-in-one: MobaXTerm</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../linux.html#copying-a-run-safely">Copying a Run Safely</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../linux.html#special-case-remote-computer-using-rsa-keys">Special Case: Remote Computer Using RSA Keys</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../linux.html#symbolic-links">Symbolic links</a></li>
<li class="toctree-l4"><a class="reference internal" href="../linux.html#archives-and-tarballs">Archives and Tarballs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../linux.html#essential-commands-in-a-schism-context">Essential commands in a SCHISM context</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../learning.html#manuals">Manuals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../learning.html#getting-help">Getting Help</a></li>
<li class="toctree-l2"><a class="reference internal" href="../learning.html#vims-and-other-external-resources">VIMS and Other External Resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../documentation.html">Contributing to the Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#getting-started">Getting Started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../documentation.html#windows">Windows</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation.html#linux">Linux</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#how-it-works">How it works</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../documentation.html#local-html-pages">Local html pages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../documentation.html#github-pages">GitHub Pages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#examples-and-concepts">Examples and Concepts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../meta_doc/doc_sphinx.html">Sphinx Documentation Principles</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../meta_doc/doc_sphinx.html#headings-order">Headings order</a></li>
<li class="toctree-l4"><a class="reference internal" href="../meta_doc/doc_sphinx.html#baydeltaschism-specifics">BayDeltaSCHISM Specifics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../meta_doc/doc_sphinx.html#sphinx-examples">Sphinx examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../meta_doc/doc_sphinx.html#math">Math</a></li>
<li class="toctree-l4"><a class="reference internal" href="../meta_doc/doc_sphinx.html#figures">Figures</a></li>
<li class="toctree-l4"><a class="reference internal" href="../meta_doc/doc_sphinx.html#diagrams">Diagrams</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../meta_doc/doc_sphinx.html#sphinx-mermaid-directive">Sphinx Mermaid Directive</a></li>
<li class="toctree-l5"><a class="reference internal" href="../meta_doc/doc_sphinx.html#embedding-charts-with-svg">Embedding Charts with SVG</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../meta_doc/doc_sphinx.html#embedding-videos">Embedding Videos</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../meta_doc/doc_mermaid.html">Mermaid Chart Principles</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../meta_doc/doc_mermaid.html#baydeltaschism-standards">BayDeltaSCHISM Standards</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../meta_doc/doc_mermaid.html#symbols">Symbols</a></li>
<li class="toctree-l5"><a class="reference internal" href="../meta_doc/doc_mermaid.html#style">Style</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../meta_doc/doc_mermaid.html#vs-code-plugin">VS Code plugin</a></li>
<li class="toctree-l4"><a class="reference internal" href="../meta_doc/doc_mermaid.html#cool-stuff">Cool stuff</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../meta_doc/doc_mermaid.html#clickables">Clickables</a></li>
<li class="toctree-l5"><a class="reference internal" href="../meta_doc/doc_mermaid.html#icons-in-an-element">Icons in an Element</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../meta_doc/doc_click.html">Click Documentation Principles</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../calibration.html">Calibration Report and References</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../calibration.html#calibration">Calibration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../help.html">Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help.html#support">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../refs.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Bay-Delta SCHISM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <!-- Empty override file take the place of env/lib/python3.8/site-packages/sphinx_rtd_theme/breadcrumbs.html, which generates the top nav breadcrumbs. -->
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="step-by-step-bay-delta-schism-on-azure">
<span id="bds-guide-azure"></span><h1>Step-by-step: Bay-Delta SCHISM on Azure<a class="headerlink" href="#step-by-step-bay-delta-schism-on-azure" title="Link to this heading"></a></h1>
<p>This guide will walk you through the process of setting up and running the Bay-Delta SCHISM model on Azure Batch.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This assumes you have already <a class="reference external" href="https://learn.microsoft.com/en-us/azure/batch/batch-account-create-portal">set up your Azure account</a> and have access to the Azure Batch service. If you haven’t done this yet, please refer to the Azure documentation for instructions on how to create an account and set up Batch.</p>
</div>
<section id="initial-setup">
<h2>Initial Setup<a class="headerlink" href="#initial-setup" title="Link to this heading"></a></h2>
<p>First, complete the Azure setup steps in <a class="reference internal" href="azure.html#setup-azure"><span class="std std-ref">Setup Azure</span></a>. You should have:</p>
<ul class="simple">
<li><dl class="simple">
<dt>azure_cli and azcopy command line utilities installed and configured</dt><dd><ul>
<li><p>meaning you can run <cite>azcopy</cite> and <cite>az</cite> commands from the command line</p></li>
<li><p>you should be logged into your azure account</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>download and install azure_dms_batch and its conda environment</p></li>
</ul>
</section>
<section id="upload-applications">
<h2>Upload Applications<a class="headerlink" href="#upload-applications" title="Link to this heading"></a></h2>
<p>Azure batch requires the setup and installation to happen via zip files that are called application packages. The user should specify these packages with the version names as specified in the template. Here we will refer to the <a class="reference external" href="https://github.com/CADWRDeltaModeling/azure_dms_batch/tree/main/dmsbatch/templates/alma87_mvapich2_20241018">alma87_mvapich2 template</a>.</p>
<p>The <a class="reference external" href="https://github.com/CADWRDeltaModeling/azure_dms_batch/blob/main/app-packages/batch_app_package_and_upload.sh">app-packages/batch_app_package_and_upload.sh</a> script can be used to upload the packages.</p>
<section id="schism">
<h3>SCHISM<a class="headerlink" href="#schism" title="Link to this heading"></a></h3>
<p>For SCHISM, you’ll need to either compile and zip the executables yourself, or you can refer to <a class="reference external" href="https://github.com/CADWRDeltaModeling/azure_dms_batch/releases">the releases page</a> and download the relevant <strong>schism_with_deps_*.zip</strong> file.</p>
<p>Save the .zip file to azure_dms_batch/app-packages.</p>
<p>Now use <a class="reference external" href="https://github.com/CADWRDeltaModeling/azure_dms_batch/blob/main/app-packages/batch_app_package_and_upload.sh">app-packages/batch_app_package_and_upload.sh</a> to upload in the command line:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export MY_BATCH_ACCOUNT=&quot;&lt;batchaccountname&gt;&quot;</span>
<span class="go">export MY_RG=&quot;&lt;resourcegroupname&gt;&quot;</span>

<span class="go">cd azure_dms_batch/app-packages</span>

<span class="go">source batch_app_package_and_upload.sh</span>

<span class="go">package_and_upload_telegraf &quot;telegraf&quot; $MY_BATCH_ACCOUNT $MY_RG</span>
<span class="go">package_and_upload_app schism_with_deps 5.11.1_alma8.7hpc_v4_mvapich2 schism_with_deps_5.11.1_alma8.7hpc_v4_mvapich2.zip  $MY_BATCH_ACCOUNT $MY_RG</span>
<span class="go">package_and_upload_app nfs_alma8.7 nfs_alma8.7.zip  $MY_BATCH_ACCOUNT $MY_RG</span>
<span class="go">package_and_upload_batch_setup &quot;../schism_scripts/&quot; $MY_BATCH_ACCOUNT $MY_RG</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="python-packages">
<h3>Python Packages<a class="headerlink" href="#python-packages" title="Link to this heading"></a></h3>
<p>For python packages like schimpy and BayDeltaSCHISM’s bdschism you can also use the <strong>batch_app_package_and_upload.sh</strong> script to upload the packages to your batch account.</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export MY_BATCH_ACCOUNT=&quot;&lt;batchaccountname&gt;&quot;</span>
<span class="go">export MY_RG=&quot;&lt;resourcegroupname&gt;&quot;</span>

<span class="go">cd azure_dms_batch/app-packages</span>

<span class="go">source batch_app_package_and_upload.sh</span>

<span class="go">package_and_upload_schimpy $MY_BATCH_ACCOUNT $MY_RG</span>
<span class="go">package_and_upload_bdschism $MY_BATCH_ACCOUNT $MY_RG</span>
</pre></div>
</div>
</div></blockquote>
<p>The above utility names the package with <em>today’s date</em> and then uploads it and sets it to the default version.</p>
<p>You can check the versions of packages and which is considered the default by going to the online <a class="reference external" href="https://portal.azure.com/">Azure Portal</a> and navigating to your batch account. ONce in your batch account, navigate to Features &gt; Applications.</p>
</section>
</section>
<section id="uploading-model-input-files">
<h2>Uploading Model Input Files<a class="headerlink" href="#uploading-model-input-files" title="Link to this heading"></a></h2>
<p>Your simulation input files (e.g., mesh, forcing files, etc.) should be uploaded to the Azure Batch storage account. This is typically done using the <cite>azcopy</cite> command line utility. For more detailed info see the <a class="reference external" href="https://learn.microsoft.com/en-us/azure/storage/common/storage-use-azcopy-v10?toc=%2Fazure%2Fstorage%2Fblobs%2Ftoc.json&amp;bc=%2Fazure%2Fstorage%2Fblobs%2Fbreadcrumb%2Ftoc.json&amp;tabs=dnf">Microsoft documentation</a>.</p>
<section id="azcopy-commands">
<h3>azcopy commands<a class="headerlink" href="#azcopy-commands" title="Link to this heading"></a></h3>
<p>The basic syntax of azcopy to copy local to Azure is:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">azcopy copy &quot;&lt;local_directory&gt;&quot; &quot;&lt;azure_storage_account/blob_container&gt;/?&lt;sas_link&gt;&quot;</span>
</pre></div>
</div>
</div></blockquote>
<dl>
<dt>and for Azure to local:</dt><dd><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">azcopy copy &quot;&lt;azure_storage_account/blob_container&gt;/?&lt;sas_link&gt;&quot; &quot;&lt;local_directory&gt;&quot;</span>
</pre></div>
</div>
</dd>
</dl>
<p>But at the Delta Modeling Section we most often use something like:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export AZLINK=&quot;https://&lt;storage_account&gt;.blob.core.windows.net/&lt;blob_storage_container/&quot;</span>
<span class="go">export sas=&quot;&lt;sas_link&gt;&quot;</span>

<span class="go">azcopy copy &quot;&lt;local_directory&gt;&quot; &quot;${AZLINK}&lt;blob_storage_container&gt;/?${sas}&quot; --exclude-regex=&quot;outputs/.\*nc&quot; --recursive --preserve-symlinks --dry-run</span>
</pre></div>
</div>
</div></blockquote>
<p>where:</p>
<ul class="simple">
<li><dl class="simple">
<dt><strong>local_directory</strong></dt><dd><ul>
<li><p>whatever local path to your simulation directory you’re uploading</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>storage_account</strong></dt><dd><ul>
<li><p>name of your Storage Account through Azure (not the same as the Batch Account name)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>blob_storage_container</strong></dt><dd><ul>
<li><p>folder path to your blob storage container</p></li>
<li><p>this will look like a folder path (eg: project_name/simulations/)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>sas_link</strong></dt><dd><ul>
<li><p>SAS permissions key (generated each day for security)</p></li>
<li><p>you can generate and copy this key by navigating to your storage account in the <a class="reference external" href="https://portal.azure.com/">Azure Portal</a> &gt; going to “Containers” &gt; find storage container &gt; right clicking &gt; Generate SAS &gt; Change “Permissions”: click all boxes &gt; Click “Generate SAS token and URL”</p></li>
<li><p>copy the “Blob SAS token option”</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="azcopy-options">
<h3>azcopy options<a class="headerlink" href="#azcopy-options" title="Link to this heading"></a></h3>
<p>These are some of the most frequently used azcopy flag options:</p>
<ul class="simple">
<li><dl class="simple">
<dt><strong>–dry-run</strong></dt><dd><ul>
<li><p>this is useful to test your command before running</p></li>
<li><p>this flag prints a list of which files will be copied where without actually uploading/downloading anything</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>–recursive</strong></dt><dd><ul>
<li><p>this will copy all files in all subdirectories</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>–preserve-symlinks</strong></dt><dd><ul>
<li><p>any symbolic links will be preserved in the upload to the blob container</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>–include-regex</strong></dt><dd><ul>
<li><p>use a Regular Expression to limit which files are included in the upload</p></li>
<li><dl class="simple">
<dt>ex: –include-regex=”suisun_(2|3|7)/.*;baseline_6/.*&quot;</dt><dd><ul>
<li><dl class="simple">
<dt>this would upload all folder contents of</dt><dd><ul>
<li><p>suisun_2/</p></li>
<li><p>suisun_3/</p></li>
<li><p>suisun_7/</p></li>
<li><p>baseline_6/</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>The <strong>.*</strong> string signifies “all contents”</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>–exclude-regex</strong></dt><dd><ul>
<li><p>use a Regular Expression to determine which files are excluded in the upload</p></li>
<li><p>this is particularly useful for things like outputs *.nc files and sflux *.nc files which are very large and costly to upload</p></li>
<li><dl class="simple">
<dt>ex: –exclude-regex=”outputs.*/.*nc;sflux/.*nc”</dt><dd><ul>
<li><p>this would exclude any files that end in “nc” that are found in the sflux, outputs, or outputs* folders</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
</section>
<section id="running-model-simulation">
<h2>Running Model Simulation<a class="headerlink" href="#running-model-simulation" title="Link to this heading"></a></h2>
<p>You can use the <strong>azure_dms_batch</strong> package’s command line utilities to submit a job to Azure.</p>
<p>Much of the setup for the virtual machines, compute nodes, etc. are determined by which template you specify in your run *.yml file.</p>
<section id="simple-run-config">
<h3>Simple Run Config<a class="headerlink" href="#simple-run-config" title="Link to this heading"></a></h3>
<p>Essentially, to fire a run you just need to submit the following command in a console which you have azure_cli, azcopy, and azure_dms_batch activated and which you’re logged into:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">dmsbatch schism submit-job --file &lt;path/to/sample_schism.yml&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p>An example of a SCHISM yaml file is <a class="reference external" href="https://github.com/CADWRDeltaModeling/azure_dms_batch/blob/main/sample_configs/sample_schism.yml">here</a>. The example yml file has many comments on each input with explanations.</p>
<p>Some important things to note:</p>
<p>The run_file.yml overrides anything in your default_config.yml (ex: <a class="reference external" href="https://github.com/CADWRDeltaModeling/azure_dms_batch/blob/main/dmsbatch/templates/alma87_mvapich2_20241018/default_config.yml">alma87_mvapich2_20241018/default_config.yml</a>)</p>
</section>
<section id="spot-pricing-config">
<h3>Spot Pricing Config<a class="headerlink" href="#spot-pricing-config" title="Link to this heading"></a></h3>
<p>The above example uses “Dedicated Nodes”. To save money (but perhaps take a bit longer time), you can use “Low Priority Nodes” or “<a class="reference external" href="https://learn.microsoft.com/en-us/azure/batch/batch-spot-vms">spot pricing</a>”. This works by sending your job to Spot VMs which run until there is another process that preempts your job.</p>
<p>This means your job needs the capacity to automatically restart from the last hotstart produced by SCHISM.</p>
<p>This <cite>example schism.yml file uses spot pricing &lt;https://github.com/CADWRDeltaModeling/azure_dms_batch/blob/main/sample_configs/sample_schism_spot_pricing.yml&gt;</cite>.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="azure.html" class="btn btn-neutral float-left" title="Running on Azure Batch" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="problems.html" class="btn btn-neutral float-right" title="Common Problems and Diagnosis" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2014,2020 California Department of Water Resources.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: white;
    }
    /* Sidebar */
    .wy-nav-side {
      background: #86989B; /* existing theme was AFC1C4 and 86989B and CA7900 and white */
      
    }
  </style>


</body>
</html>