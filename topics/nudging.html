<!-- Empty override file take the place of env/lib/python3.8/site-packages/sphinx_rtd_theme/breadcrumbs.html, which generates the top nav breadcrumbs. -->

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nudging Files &mdash; Bay-Delta SCHISM</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=ca842793"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs"></script>
      <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";import elkLayouts from "https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs";mermaid.registerLayoutLoaders(elkLayouts);mermaid.initialize({startOnLoad:false});</script>
      <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
      <script type="module">
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.addEventListener("load", () => mermaid.run());
</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Vegetation" href="vegetation.html" />
    <link rel="prev" title="Run Initialization and Restart (Hotstart)" href="hotstart.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/logo6.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Bay-Delta SCHISM Project</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getmodel.html">Installation And Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getmodel.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getmodel.html#schism-code-or-binaries">SCHISM Code or Binaries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getmodel.html#downloading">Downloading</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getmodel.html#compile-settings">Compile Settings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getmodel.html#git">Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getmodel.html#bay-delta-package">Bay-Delta Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getmodel.html#required-python-packages">Required Python Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getmodel.html#configuration-system">Configuration System</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getmodel.html#id1">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getmodel.html#configuration-file-locations-and-priorities">Configuration File Locations and Priorities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getmodel.html#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getmodel.html#example-configuration-file">Example Configuration File</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getmodel.html#bathymetry">Bathymetry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getmodel.html#complete-sample-inputs">Complete Sample Inputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getmodel.html#visit-schism-plug-in">VisIt SCHISM Plug-in</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getmodel.html#links-to-tools">Links to tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../learning.html">Learning Resources for Bay-Delta SCHISM</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../learning.html#general-resources-and-tools">General Resources and Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../learning.html#manuals">Manuals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../learning.html#getting-help">Getting Help</a></li>
<li class="toctree-l2"><a class="reference internal" href="../learning.html#vims-and-other-external-resources">VIMS and Other External Resources</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../user_guide.html">Bay-Delta SCHISM User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#bay-delta-schism-setup">Bay-Delta SCHISM Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getmodel.html">Getting the Tools and Setting Up</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getmodel.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getmodel.html#schism-code-or-binaries">SCHISM Code or Binaries</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getmodel.html#git">Git</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getmodel.html#bay-delta-package">Bay-Delta Package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getmodel.html#required-python-packages">Required Python Packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getmodel.html#configuration-system">Configuration System</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getmodel.html#bathymetry">Bathymetry</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getmodel.html#complete-sample-inputs">Complete Sample Inputs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getmodel.html#visit-schism-plug-in">VisIt SCHISM Plug-in</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getmodel.html#links-to-tools">Links to tools</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="processed_run.html">Running a Preprepared Setup</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../user_guide.html#bay-delta-schism-essentials">Bay-Delta SCHISM Essentials</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#overview">Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="overview.html">Overview of a Bay-Delta SCHISM Run</a></li>
<li class="toctree-l4"><a class="reference internal" href="vignette.html">Vignette: Hindcast Bay Delta SCHISM at Delta Modeling Section with Preprocessor</a></li>
<li class="toctree-l4"><a class="reference internal" href="files_and_directories.html">Required Files, Directory Structure and Recommended Study Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="preprocess.html">Grid, Spatial Data and Preprocessor</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="reference internal" href="../user_guide.html#boundaries-input-files">Boundaries &amp; Input Files</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="ocean.html">Prepare Ocean Boundary (elev2D.th.nc)</a></li>
<li class="toctree-l4"><a class="reference internal" href="flow_boundary.html">Inflow/Outflow Boundaries</a></li>
<li class="toctree-l4"><a class="reference internal" href="atmospheric.html">Atmospheric setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="barotropic.html">Ocean Boundary Stabilization: Barotropic Warmup</a></li>
<li class="toctree-l4"><a class="reference internal" href="param.html">Key Run Parameters and Gotchas</a></li>
<li class="toctree-l4"><a class="reference internal" href="hotstart.html">Run Initialization and Restart (Hotstart)</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Nudging Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="vegetation.html">Vegetation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#inspection-of-model-setup">Inspection of Model Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="checklists.html">Checklists</a></li>
<li class="toctree-l4"><a class="reference internal" href="run_tests.html">Test Suite for Prechecking Runs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../user_guide.html#output-files">Output Files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="output.html">Output</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#advanced-tasks-and-concepts">Advanced Tasks and Concepts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="problems.html">Common Problems and Diagnosis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="problems.html#where-does-schism-write-error-messages">Where does SCHISM write error messages?</a></li>
<li class="toctree-l4"><a class="reference internal" href="problems.html#my-run-says-segfault">My run says “segfault”</a></li>
<li class="toctree-l4"><a class="reference internal" href="problems.html#the-runs-seems-very-slow-compared-to-normal">The runs seems very slow compared to normal</a></li>
<li class="toctree-l4"><a class="reference internal" href="problems.html#dry-boundary">Dry boundary</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="age.html">Simulating water age</a><ul>
<li class="toctree-l4"><a class="reference internal" href="age.html#compile-with-age">Compile with age</a></li>
<li class="toctree-l4"><a class="reference internal" href="age.html#parameters-in-param-nml">Parameters in param.nml</a></li>
<li class="toctree-l4"><a class="reference internal" href="age.html#additional-ic-files">Additional *.ic files</a></li>
<li class="toctree-l4"><a class="reference internal" href="age.html#hotstart-considerations">Hotstart considerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="age.html#typical-output-processing">Typical output processing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="sea_level_rise.html">Sea Level Rise</a></li>
<li class="toctree-l3"><a class="reference internal" href="sources.html">Sources, Sinks, Delta Channel Depletions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="sources.html#identifying-source-locations-and-names-in-preprocessor">Identifying source locations and names in preprocessor</a></li>
<li class="toctree-l4"><a class="reference internal" href="sources.html#delta-and-suisun-channel-depletions">Delta and Suisun channel depletions</a></li>
<li class="toctree-l4"><a class="reference internal" href="sources.html#making-sure-you-includ-the-th-files-for-sources-sinks">Making sure you includ the th files for sources/sinks</a></li>
<li class="toctree-l4"><a class="reference internal" href="sources.html#tracer-concentrations">Tracer concentrations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="structures.html">Hydraulic Structures</a><ul>
<li class="toctree-l4"><a class="reference internal" href="structures.html#where-is-the-documentation">Where is the documentation?</a></li>
<li class="toctree-l4"><a class="reference internal" href="structures.html#setting-up-the-mesh-to-make-structures-easy">Setting up the mesh to make structures easy</a></li>
<li class="toctree-l4"><a class="reference internal" href="structures.html#preventing-dry-boundary-messages">Preventing dry boundary messages</a></li>
<li class="toctree-l4"><a class="reference internal" href="structures.html#important-bay-delta-examples">Important Bay-Delta examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mesh.html">Gridding the Horizontal Mesh</a><ul>
<li class="toctree-l4"><a class="reference internal" href="mesh.html#meshing">Meshing</a></li>
<li class="toctree-l4"><a class="reference internal" href="mesh.html#vertical-mesh-setup">Vertical mesh setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="mesh.html#checklist-for-after-you-change-the-mesh">Checklist for after you change the mesh</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="utilities.html">Utilities and Scripts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="utilities.html#gis-conversion">GIS Conversion</a></li>
<li class="toctree-l4"><a class="reference internal" href="utilities.html#hotstart-inventory-convert-iteration-numbers-to-dates">Hotstart Inventory: Convert iteration numbers to dates</a></li>
<li class="toctree-l4"><a class="reference internal" href="utilities.html#model-time-and-multi-clip">model_time and multi_clip</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../calibration.html">Calibration Report and References</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../calibration.html#calibration">Calibration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../help.html">Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help.html#support">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../refs.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Bay-Delta SCHISM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <!-- Empty override file take the place of env/lib/python3.8/site-packages/sphinx_rtd_theme/breadcrumbs.html, which generates the top nav breadcrumbs. -->
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="nudging-files">
<span id="nudging"></span><h1>Nudging Files<a class="headerlink" href="#nudging-files" title="Link to this heading"></a></h1>
<section id="introduction-what-is-nudging">
<h2>Introduction: What is nudging?<a class="headerlink" href="#introduction-what-is-nudging" title="Link to this heading"></a></h2>
<figure class="align-center" id="id1">
<span id="nudge-obs-grid"></span><a class="with-border reference internal image-reference" href="../_images/nudging_obs_gr3.png"><img alt="../_images/nudging_obs_gr3.png" class="with-border" src="../_images/nudging_obs_gr3.png" style="width: 70%;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 4 </span><span class="caption-text">Nudging relaxation shown around EC and temperature stations. Red shows where the nudging is applied the greatest, Blue is the least, and White induces no nudging. The relaxation constants are specified in the [MOD]_nudge.gr3 file. The locations and values are specified in the *.yaml files.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id2">
<span id="nudge-ocean-grid"></span><a class="with-border reference internal image-reference" href="../_images/nudging_ocean_gr3.png"><img alt="../_images/nudging_ocean_gr3.png" class="with-border" src="../_images/nudging_ocean_gr3.png" style="width: 70%;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 5 </span><span class="caption-text">Nudging relaxation shown along the ocean boundary. Similar color scale to Fig. <a class="reference internal" href="#nudge-obs-grid"><span class="std std-numref">Fig. 4</span></a>. Also the stations used to interpolate along the ocean boundary are specified in the *.yaml files.</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>In SCHISM you can use a NetCDF file that coerces/nudges module values towards an observed or set timeseries in specific points throughout the model.
You can see the param.nml settings in the nudging block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>inu_tr(1) = 2 !T
inu_tr(2) = 2 !S
inu_tr(3) = 0 !GEN
inu_tr(4) = 0 !Age
inu_tr(5) = 0 !SED3D
inu_tr(6) = 0 !EcoSim
inu_tr(7) = 0 !ICM
inu_tr(8) = 0 !CoSINE
inu_tr(9) = 0 !FIB
inu_tr(10) = 0 !TIMOR
inu_tr(11) = 0 !FABM

vnh1 = 400 !vertical nudging depth 1
vnf1 = 0. !vertical relax \in [0,1]
vnh2 = 500 !vertical nudging depth 2 (must &gt;vnh1)
vnf2 = 0. !vertical relax

step_nu_tr = 3600. !time step [sec] in all [MOD]_nu.nc (for inu_[MOD]=2)
</pre></div>
</div>
<p>Where inu_tr(N) is set to 2 if a NetCDF file is used to nudge values for that module, and set to 0 if no nudging is used. For instance temperature (N=1) or salinity (N=2) are most often set to 2, and require <cite>[MOD]_nu.nc`</cite> as well as <cite>[MOD]_nudge.gr3`</cite> as inputs. The .nc file specifies the values to be nudged to, and the .gr3 file specifies the horizontal relaxation constants, which are applied with the vertical nudging relaxation specified by a linear function of <cite>vnh[1,2]</cite> and <cite>vnf[1,2]</cite>. We typically use one hour nudging (3600) which is needed if using data with relatively fast nudging rates.</p>
</section>
<section id="do-i-need-nudging">
<h2>Do I need nudging?<a class="headerlink" href="#do-i-need-nudging" title="Link to this heading"></a></h2>
</section>
<section id="prepping-the-data">
<h2>Prepping the data<a class="headerlink" href="#prepping-the-data" title="Link to this heading"></a></h2>
</section>
<section id="sequencing-your-run">
<h2>Sequencing your run<a class="headerlink" href="#sequencing-your-run" title="Link to this heading"></a></h2>
<pre id="nudge-flow" class="mermaid">
        graph LR
  hgrid[hgrid.gr3] --&gt; nudge_py[Run: nudging.py];
  vgrid3[&quot;vgrid.in.3d&quot;] --&gt; nudge_py;
  nudge([&quot;Start: nudging input&quot;]) --&gt; nudge_ts[&quot;Nudging time series in .csv&quot;] --&gt; nudge_py;
  nudge_py --&gt; nudge_nc[&quot;{MOD}_nu.nc &amp; {MOD_nudge.gr3}&quot;];
  hycom_input[&quot;hycom_input&quot;] --&gt; nudge_py;
  nudge_nc --&gt; baroclinic{&quot;Baroclinic Simulation&quot;};
    </pre></section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="hotstart.html" class="btn btn-neutral float-left" title="Run Initialization and Restart (Hotstart)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="vegetation.html" class="btn btn-neutral float-right" title="Vegetation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2014,2020 California Department of Water Resources.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: white;
    }
    /* Sidebar */
    .wy-nav-side {
      background: #86989B; /* existing theme was AFC1C4 and 86989B and CA7900 and white */
      
    }
  </style>


</body>
</html>