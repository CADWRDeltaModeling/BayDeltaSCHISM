<!-- Empty override file take the place of env/lib/python3.8/site-packages/sphinx_rtd_theme/breadcrumbs.html, which generates the top nav breadcrumbs. -->

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vegetation &mdash; Bay-Delta SCHISM</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=ca842793"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Vignette: Hindcast Bay Delta SCHISM at Delta Modeling Section with Preprocessor" href="vignette.html" />
    <link rel="prev" title="Output" href="output.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/logo6.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Bay-Delta SCHISM Project</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getmodel.html">Installation And Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../learning.html">Learning Resources for Bay-Delta SCHISM</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../learning.html#general-resources-and-tools">General Resources and Tools</a><ul class="current">
<li class="toctree-l3"><a class="reference external" href="https://cadwrdeltamodeling.github.io/HelloSCHISM/">Hello SCHISM</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../user_guide.html">Bay Delta SCHISM User Guide</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../getmodel.html">Getting the Tools and Setting Up</a></li>
<li class="toctree-l4"><a class="reference internal" href="processed_run.html">Running a Preprepared Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="overview.html">Overview of a Bay-Delta SCHISM Run</a></li>
<li class="toctree-l4"><a class="reference internal" href="files_and_directories.html">Required Files, Directory Structure and Recommended Study Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="preprocess.html">Grid, Spatial Data and Preprocessor</a></li>
<li class="toctree-l4"><a class="reference internal" href="ocean.html">Prepare Ocean Boundary (elev2D.th.nc)</a></li>
<li class="toctree-l4"><a class="reference internal" href="flow_boundary.html">Inflow/Outflow Boundaries</a></li>
<li class="toctree-l4"><a class="reference internal" href="atmospheric.html">Atmospheric setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="barotropic.html">Ocean Boundary Stabilization: Barotropic Warmup</a></li>
<li class="toctree-l4"><a class="reference internal" href="param.html">Key Run Parameters and Gotchas</a></li>
<li class="toctree-l4"><a class="reference internal" href="hotstart.html">Run Initialization and Restart (Hotstart)</a></li>
<li class="toctree-l4"><a class="reference internal" href="nudging.html">Nudging Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="output.html">Output</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Vegetation</a></li>
<li class="toctree-l4"><a class="reference internal" href="vignette.html">Vignette: Hindcast Bay Delta SCHISM at Delta Modeling Section with Preprocessor</a></li>
<li class="toctree-l4"><a class="reference internal" href="checklists.html">Checklists</a></li>
<li class="toctree-l4"><a class="reference internal" href="run_tests.html">Test Suite for Prechecking Runs</a></li>
<li class="toctree-l4"><a class="reference internal" href="mesh.html">Horizontal Mesh</a></li>
<li class="toctree-l4"><a class="reference internal" href="problems.html">Common Problems and Diagnosis</a></li>
<li class="toctree-l4"><a class="reference internal" href="age.html">Simulating water age</a></li>
<li class="toctree-l4"><a class="reference internal" href="sea_level_rise.html">Sea Level Rise</a></li>
<li class="toctree-l4"><a class="reference internal" href="sources.html">Sources, Sinks, Delta Channel Depletions</a></li>
<li class="toctree-l4"><a class="reference internal" href="structures.html">Hydraulic Structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="utilities.html">Utilities and Scripts</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../linux.html">Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="../learning.html#manuals">Manuals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../learning.html#getting-help">Getting Help</a></li>
<li class="toctree-l3"><a class="reference internal" href="../learning.html#vims-and-other-external-resources">VIMS and Other External Resources</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../user_guide.html">Bay-Delta SCHISM User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../getmodel.html">Getting the Tools and Setting Up</a></li>
<li class="toctree-l2"><a class="reference internal" href="processed_run.html">Running a Preprepared Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html">Overview of a Bay-Delta SCHISM Run</a></li>
<li class="toctree-l2"><a class="reference internal" href="files_and_directories.html">Required Files, Directory Structure and Recommended Study Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="preprocess.html">Grid, Spatial Data and Preprocessor</a></li>
<li class="toctree-l2"><a class="reference internal" href="ocean.html">Prepare Ocean Boundary (elev2D.th.nc)</a></li>
<li class="toctree-l2"><a class="reference internal" href="flow_boundary.html">Inflow/Outflow Boundaries</a></li>
<li class="toctree-l2"><a class="reference internal" href="atmospheric.html">Atmospheric setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="barotropic.html">Ocean Boundary Stabilization: Barotropic Warmup</a></li>
<li class="toctree-l2"><a class="reference internal" href="param.html">Key Run Parameters and Gotchas</a></li>
<li class="toctree-l2"><a class="reference internal" href="hotstart.html">Run Initialization and Restart (Hotstart)</a></li>
<li class="toctree-l2"><a class="reference internal" href="nudging.html">Nudging Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="output.html">Output</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Vegetation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#aquatic-vegetation-in-schism">Aquatic Vegetation in SCHISM</a></li>
<li class="toctree-l3"><a class="reference internal" href="#approximations-and-preprocessor">Approximations and preprocessor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#effective-stem-density">Effective Stem Density</a></li>
<li class="toctree-l3"><a class="reference internal" href="#height">Height</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="vignette.html">Vignette: Hindcast Bay Delta SCHISM at Delta Modeling Section with Preprocessor</a></li>
<li class="toctree-l2"><a class="reference internal" href="checklists.html">Checklists</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_tests.html">Test Suite for Prechecking Runs</a></li>
<li class="toctree-l2"><a class="reference internal" href="mesh.html">Horizontal Mesh</a></li>
<li class="toctree-l2"><a class="reference internal" href="problems.html">Common Problems and Diagnosis</a></li>
<li class="toctree-l2"><a class="reference internal" href="age.html">Simulating water age</a></li>
<li class="toctree-l2"><a class="reference internal" href="sea_level_rise.html">Sea Level Rise</a></li>
<li class="toctree-l2"><a class="reference internal" href="sources.html">Sources, Sinks, Delta Channel Depletions</a></li>
<li class="toctree-l2"><a class="reference internal" href="structures.html">Hydraulic Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities.html">Utilities and Scripts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../calibration.html">Calibration Report and References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help.html">Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help.html#support">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../refs.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Bay-Delta SCHISM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <!-- Empty override file take the place of env/lib/python3.8/site-packages/sphinx_rtd_theme/breadcrumbs.html, which generates the top nav breadcrumbs. -->
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="vegetation">
<h1>Vegetation<a class="headerlink" href="#vegetation" title="Link to this heading"></a></h1>
<section id="aquatic-vegetation-in-schism">
<h2>Aquatic Vegetation in SCHISM<a class="headerlink" href="#aquatic-vegetation-in-schism" title="Link to this heading"></a></h2>
<p>In Bay-Delta SCHISM, the modeling of submerged aquatic vegetation (SAV)
is on by default, with data in or approximations in
Franks Tract, Cache Complex, South Delta.</p>
<p>SCHISM has a submerged aquatic vegetation module  introduced by <span id="id1">[<a class="reference internal" href="../refs.html#id5" title="Yinglong J. Zhang, Nathan Gerdts, Eli Ateljevich, and Kijin Nam. Simulating vegetation effects on flows in 3d using an unstructured grid model: model development and validation. Ocean Dynamics, 2020. URL: http://link.springer.com/10.1007/s10236-019-01333-8 (visited on 2022-11-05), doi:10.1007/s10236-019-01333-8.">ZGAN20</a>]</span>, and covered in
online manual which includes the effects of drag within the canopy,
and simple representation of turbulence production. Biogeochemical linkages (shading, nutrient competition) are also included
in the water quality/ecological modules. In the instances where we have introduced vegetation (Cache Complex, Franks Tract, South Delta, Sherman Lake)  it has helped reproduced the distribution of physical flow.</p>
<p>SCHISM can model submerged vegetation (example: Egeria Densa) or with a suitably high
canopy emergent vegetation vegetation, such as tule. Primrose can also be
approximated as emergent. Accommodation must be made for patchy floating species such
as hyacinth.</p>
<p>In SCHISM, vegetation is enabled using the parameter isav=1 in the control file param.nml. For turbulence production
the native “SCHISM” turbulence closures must be used, not GOTM.</p>
<table class="docutils align-default" id="id3">
<caption><span class="caption-number">Table 2 </span><span class="caption-text">Vegetation Files</span><a class="headerlink" href="#id3" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 25.0%" />
<col style="width: 25.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>SCHISM file name</p></th>
<th class="head"><p>Example preprocessor name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>sav_N.gr3</p></td>
<td><p>sav_density.yaml</p></td>
<td><p>stem density per square meter</p></td>
</tr>
<tr class="row-odd"><td><p>sav_D.gr3</p></td>
<td><p>sav_diameter</p></td>
<td><p>stem diameter</p></td>
</tr>
<tr class="row-even"><td><p>sav_cd.gr3</p></td>
<td><p>constant</p></td>
<td><p>coefficient of drag (we currently use 0.20 to 0.28, but see text below)</p></td>
</tr>
<tr class="row-odd"><td><p>sav_h.gr3</p></td>
<td><p>sav_height.yaml</p></td>
<td><p>canopy height</p></td>
</tr>
</tbody>
</table>
<p>The first three parameters are multiplied by one another. There is rarely enough data to make them
statistically identifiable individually, a point revisited below.
Canopy height is from the bed. We usually assume the canopy reaches -0.15cm NAVD in the main Delta.
which is a compromise based on the fact that apparent effective density diminishes in the upper centimeters.</p>
</section>
<section id="approximations-and-preprocessor">
<h2>Approximations and preprocessor<a class="headerlink" href="#approximations-and-preprocessor" title="Link to this heading"></a></h2>
<p>Key challenges when modeling vegetation with SCHISM are:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>data coverage</p></li>
<li><p>interpretation of data as effective density</p></li>
<li><p>including enough vertical resolution to allow a boundary layer over the vegetation</p></li>
</ol>
</div></blockquote>
</section>
<section id="effective-stem-density">
<h2>Effective Stem Density<a class="headerlink" href="#effective-stem-density" title="Link to this heading"></a></h2>
<p>Because we usually don’t have detailed knowledge of the drag coefficient diameter and stem density
and because they all end up multiplied by one another, there is effectively
a single degree of freedom when it comes to the overall density of the vegetation field.</p>
<p>We fix the diameter and density and use an “effective stem density” that accounts for variation in drag,
subgrid heterogeneity of the field as well as point values of stem density. In the past we have used
stem densities of 10-30 per meter squared (lower-medium) and 30-60 per meter squared (heavy) coupled with a drag
coefficient of 0.20 to 0.26. You may see legacy files where the stem density is much lower and the drag higher, but
the product in this case is the same general magnitude. For instance, for a fixed diameter 8 stems/m^2 and drag 1.13
give the same product as instead of 20-60 stems/m^2 and drag 0.28.</p>
<p>At times when remote sensing was not available, the template included estimates based on heuristics about depth,
using only one high and one low value, consistent for the most part with the <span id="id2">[<a class="reference internal" href="../refs.html#id4" title="John Durand, William Fleenor, Richard and McElreath, Max Planck Institute for Evolutionary Anthropology, Maria J. Santos, and Peter and and Moyle. Physical controls on the distribution of the submersed aquatic weed egeria densa in the sacramento-san joaquin delta, california and implications for habitat restoration. San Francisco Estuary and Watershed Science, 2016. URL: http://escholarship.org/uc/item/85c9h479, doi:10.15447/sfews.2016v14iss1art4.">DFaM+16</a>]</span>
conclusion that most Egeria densa grew between depths of 2m and -1m MLLW and assuming that density is higher in water that
is less than 0.9m at low water.</p>
<p>In areas where we have imagery, we use processed Normalized Density Vegetation Index from the Ustin lab at UC Davis.
More properly, these are modified NDVI (mNDVI) with more attention in the margins of the
red band and slightly lower values than ordinary NDVI. The NVDI image is often the best
source of information on spatial distribution of effective density. However, NDVI is not
as accurate in the water as it is for terrestrial vegetation. Absolute values
vary between captures so there is still a reliance on field descriptions and a degree of fitting on overall strength
based on looking at the histogram and breaking it into a “no”, “low” and “high” bracket.
The “no vegetation” or zero density is typically assigned for mNDVI &lt; -0.05, but for some
images histogram is clustered at lower values.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">- attribute: raster_to_nodes.raster_to_nodes(mesh, nodes_sel, &#39;//path/to/delta_NDVI.tif&#39;,</span>
<span class="go">    bins=[-998.,-0.2,0,0.4,1.0],</span>
<span class="go">    mapped_values=[-999., 0., 10., 30., 60., -999.],</span>
<span class="go">    mask_value=0.,</span>
<span class="go">    fill_value=-0.21)</span>
<span class="go">  name: Clifton Court</span>
<span class="go">  type: none</span>
<span class="go">  imports: schimpy.raster_to_nodes</span>
<span class="go">  vertices:</span>
<span class="go">  - - 622760.2566469825</span>
<span class="go">    - 4191499.7722536493</span>
<span class="go">    ....</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://cadwrdeltamodeling.github.io/schimpy/schimpy.html#schimpy.raster_to_nodes.raster_to_nodes" title="(in schimpy v1.10.0+11.g81554eb.dirty)"><code class="xref py py-func docutils literal notranslate"><span class="pre">schimpy.raster_to_nodes.raster_to_nodes()</span></code></a> manual page has more info on this function. Index <cite>i</cite> in the
mapped values is applied between <cite>i-1</cite> and <cite>i</cite> in the bins. The mapped values have to be larger than the number of bins,
which is an artifact of the numpy digitize method used to implement the function.</p>
</section>
<section id="height">
<h2>Height<a class="headerlink" href="#height" title="Link to this heading"></a></h2>
<p>Template formulas usually enforce a minimum height of (say 0.25m below),
a maximum (say 1.0m below) and assume that the vegetation grow to a effective height that reaches just
below a typical low water mark, slightly lower than the highest whorl you’d see in a boat).
Here is a sample from <cite>sav_height.yaml</cite>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">- name: Franks Tract</span>
<span class="go">  type: none</span>
<span class="go">  attribute: &#39;max(0.25,min(1.0,z-0.01))&#39;</span>
<span class="go">  vertices:</span>
<span class="go">     ... coordinates</span>
</pre></div>
</div>
<p>When a mix of emergent and submerged vegetation is required, a more complex formula is required. Emergent
vegetation is represented using exaggerated height.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="output.html" class="btn btn-neutral float-left" title="Output" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="vignette.html" class="btn btn-neutral float-right" title="Vignette: Hindcast Bay Delta SCHISM at Delta Modeling Section with Preprocessor" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2014,2020 California Department of Water Resources.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: white;
    }
    /* Sidebar */
    .wy-nav-side {
      background: #86989B; /* existing theme was AFC1C4 and 86989B and CA7900 and white */
      
    }
  </style>


</body>
</html>